<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Advanced Data Aggregation — collap • collapse</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Advanced Data Aggregation — collap"><meta property="og:description" content="collap is a fast and easy to use multi-purpose data aggregation command.
It performs simple aggregations, multi-type data aggregations applying different functions to numeric and categorical data, weighted aggregations, multi-function aggregations applying multiple functions to each column, and fully customized aggregations where the user passes a list mapping functions to columns.
collap works with collapse's Fast Statistical Functions, providing extremely fast conventional and weighted aggregation. It also works with other functions but this does not deliver high speeds on large data and does not support weighted aggregations.
"><meta property="og:image" content="/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.8.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" class="external-link">Blog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/collapse_R" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Advanced Data Aggregation</h1>
    
    <div class="hidden name"><code>collap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>collap</code> is a fast and easy to use multi-purpose data aggregation command.</p>
<p>It performs simple aggregations, multi-type data aggregations applying different functions to numeric and categorical data, weighted aggregations, multi-function aggregations applying multiple functions to each column, and fully customized aggregations where the user passes a list mapping functions to columns.</p>
<p><code>collap</code> works with <em>collapse</em>'s <a href="fast-statistical-functions.html">Fast Statistical Functions</a>, providing extremely fast conventional and weighted aggregation. It also works with other functions but this does not deliver high speeds on large data and does not support weighted aggregations.</p>
<p><!-- % \code{collap} supports formula and data (i.e. grouping vectors or lists of vectors) input to \code{by}, whereas \code{collapv} allows names and indices of grouping columns to be passed to \code{by}. --></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="co"># Main function: allows formula and data input to `by` and `w` arguments</span>
<span class="fu">collap</span><span class="op">(</span><span class="va">X</span>, <span class="va">by</span>, FUN <span class="op">=</span> <span class="va">fmean</span>, catFUN <span class="op">=</span> <span class="va">fmode</span>, cols <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, wFUN <span class="op">=</span> <span class="va">fsum</span>,
       custom <span class="op">=</span> <span class="cn">NULL</span>, keep.by <span class="op">=</span> <span class="cn">TRUE</span>, keep.w <span class="op">=</span> <span class="cn">TRUE</span>, keep.col.order <span class="op">=</span> <span class="cn">TRUE</span>,
       sort <span class="op">=</span> <span class="cn">TRUE</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span>, na.last <span class="op">=</span> <span class="cn">TRUE</span>, return.order <span class="op">=</span> <span class="va">sort</span>,
       method <span class="op">=</span> <span class="st">"auto"</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores <span class="op">=</span> <span class="fl">2L</span>,
       return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wide"</span>,<span class="st">"list"</span>,<span class="st">"long"</span>,<span class="st">"long_dupl"</span><span class="op">)</span>, give.names <span class="op">=</span> <span class="st">"auto"</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># Programmer function: allows column names and indices input to `by` and `w` arguments</span>
<span class="fu">collapv</span><span class="op">(</span><span class="va">X</span>, <span class="va">by</span>, FUN <span class="op">=</span> <span class="va">fmean</span>, catFUN <span class="op">=</span> <span class="va">fmode</span>, cols <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, wFUN <span class="op">=</span> <span class="va">fsum</span>,
        custom <span class="op">=</span> <span class="cn">NULL</span>, keep.by <span class="op">=</span> <span class="cn">TRUE</span>, keep.w <span class="op">=</span> <span class="cn">TRUE</span>, keep.col.order <span class="op">=</span> <span class="cn">TRUE</span>,
        sort <span class="op">=</span> <span class="cn">TRUE</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span>, na.last <span class="op">=</span> <span class="cn">TRUE</span>, return.order <span class="op">=</span> <span class="va">sort</span>,
        method <span class="op">=</span> <span class="st">"auto"</span>, parallel <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores <span class="op">=</span> <span class="fl">2L</span>,
        return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wide"</span>,<span class="st">"list"</span>,<span class="st">"long"</span>,<span class="st">"long_dupl"</span><span class="op">)</span>, give.names <span class="op">=</span> <span class="st">"auto"</span>, <span class="va">...</span><span class="op">)</span>

<span class="co"># Auxiliary function: for grouped data ('grouped_df') input + non-standard evaluation</span>
<span class="fu">collapg</span><span class="op">(</span><span class="va">X</span>, FUN <span class="op">=</span> <span class="va">fmean</span>, catFUN <span class="op">=</span> <span class="va">fmode</span>, cols <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, wFUN <span class="op">=</span> <span class="va">fsum</span>, custom <span class="op">=</span> <span class="cn">NULL</span>,
        keep.group_vars <span class="op">=</span> <span class="cn">TRUE</span>, keep.w <span class="op">=</span> <span class="cn">TRUE</span>, keep.col.order <span class="op">=</span> <span class="cn">TRUE</span>,
        parallel <span class="op">=</span> <span class="cn">FALSE</span>, mc.cores <span class="op">=</span> <span class="fl">2L</span>,
        return <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wide"</span>,<span class="st">"list"</span>,<span class="st">"long"</span>,<span class="st">"long_dupl"</span><span class="op">)</span>, give.names <span class="op">=</span> <span class="st">"auto"</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>X</dt>
<dd><p>a data frame, or an object coercible to data frame using <code><a href="quick-conversion.html">qDF</a></code>.</p></dd>

  <dt>by</dt>
<dd><p>for <code>collap</code>: a one-or two sided formula, i.e. <code>~ group1</code> or <code>var1 + var2 ~ group1 + group2</code>, or a atomic vector, list of vectors or <code><a href="GRP.html">GRP</a></code> object used to group <code>X</code>. For <code>collapv</code>: names or indices of grouping columns, or a logical vector or selector function such as <code><a href="small-helpers.html">is_categorical</a></code> selecting grouping columns.</p></dd>

<dt>FUN</dt>
<dd><p>a function, list of functions (i.e. <code>list(fsum, fmean, fsd)</code> or <code>list(myfun1 = function(x).., sd = sd)</code>), or a character vector of function names, which are automatically applied only to numeric variables.</p></dd>

<dt>catFUN</dt>
<dd><p>same as <code>FUN</code>, but applied only to categorical (non-numeric) typed columns (<code><a href="small-helpers.html">is_categorical</a></code>).</p></dd>

<dt>cols</dt>
<dd><p>select columns to aggregate using a function, column names, indices or logical vector. <em>Note</em>: <code>cols</code> is ignored if a two-sided formula is passed to <code>by</code>.</p></dd>

<dt>w</dt>
<dd><p>weights. Can be passed as numeric vector or alternatively as formula i.e. <code>~ weightvar</code> in <code>collap</code> or column name / index etc. i.e. <code>"weightvar"</code> in <code>collapv</code>. <code>collapg</code> supports non-standard evaluations so <code>weightvar</code> can be indicated without quotes if found in <code>X</code>.</p></dd>

<dt>wFUN</dt>
<dd><p>same as <code>FUN</code>: Function(s) to aggregate weight variable if <code>keep.w = TRUE</code>. By default the sum of the weights is computed in each group.</p></dd>


<dt>custom</dt>
<dd><p>a named list specifying a fully customized aggregation task. The names of the list are function names and the content columns to aggregate using this function (same input as <code>cols</code>). For example <code>custom = list(fmean = 1:6, fsd = 7:9, fmode = 10:11)</code> tells <code>collap</code> to aggregate columns 1-6 of <code>X</code> using the mean, columns 7-9 using the standard deviation etc. <em>Notes</em>: <code>custom</code> lets <code>collap</code> ignore any inputs passed to <code>FUN</code>, <code>catFUN</code> or <code>cols</code>. Since v1.6.0 you can also rename columns e.g. <code>custom = list(fmean = c(newname = "col1", "col2"), fmode = c(newname = 3))</code>.</p></dd>

<dt>keep.by, keep.group_vars</dt>
<dd><p>logical. <code>FALSE</code> will omit grouping variables from the output. <code>TRUE</code> keeps the variables, even if passed externally in a list or vector (unlike other <em>collapse</em> functions).</p></dd>

<dt>keep.w</dt>
<dd><p>logical. <code>FALSE</code> will omit weight variable from the output i.e. no aggregation of the weights. <code>TRUE</code> aggregates and adds weights, even if passed externally as a vector (unlike other <em>collapse</em> functions).</p></dd>

<dt>keep.col.order</dt>
<dd><p>logical. Retain original column order post-aggregation.</p></dd>

<dt>sort, decreasing, na.last, return.order, method</dt>
<dd><p>logical / character. Arguments passed to <code><a href="GRP.html">GRP.default</a></code> and affecting the row-order in the aggregated data frame and the grouping algorithm.</p></dd>

<dt>parallel</dt>
<dd><p>logical. Use <code>mclapply</code> instead of <code>lapply</code> to parallelize the computation at the column level. Not available for Windows.</p></dd>

<dt>mc.cores</dt>
<dd><p>integer. Argument to <code>mclapply</code> setting the number of cores to use, default is 2.</p></dd>

<dt>return</dt>
<dd><p>character. Control the output format when aggregating with multiple functions or performing custom aggregation. "wide" (default) returns a wider data frame with added columns for each additional function. "list" returns a list of data frames - one for each function. "long" adds a column "Function" and row-binds the results from different functions using <code><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">data.table::rbindlist</a></code>. "long.dupl" is a special option for aggregating multi-type data using multiple <code>FUN</code> but only one <code>catFUN</code> or vice-versa. In that case the format is long and data aggregated using only one function is duplicated. See Examples.</p></dd>

<dt>give.names</dt>
<dd><p>logical. Create unique names of aggregated columns by adding a prefix 'FUN.var'. <code>'auto'</code> will automatically create such prefixes whenever multiple functions are applied to a column. <!-- % By default \code{"."} is used as a separator between 'FUN' and 'var'. It is also possible to choose a different separator by specifying \code{give.names = "_"}, for example. --></p></dd>

</dl><p><!-- % \item{sort.row}{depreciated, renamed to \code{sort}.} --></p>
<dl><dt>...</dt>
<dd><p>additional arguments passed to all functions supplied to <code>FUN</code>, <code>catFUN</code>, <code>wFUN</code> or <code>custom</code>. The behavior of <a href="fast-statistical-functions.html">Fast Statistical Functions</a> is regulated by <code>option("collapse_unused_arg_action")</code> and defaults to <code>"warning"</code>.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>collap</code> automatically checks each function passed to it whether it is a <a href="fast-statistical-functions.html">Fast Statistical Function</a> (i.e. whether the function name is contained in <code>.FAST_STAT_FUN</code>). If the function is a fast statistical function, <code>collap</code> only does the grouping and then calls the function to carry out the grouped computations. If the function is not one of <code>.FAST_STAT_FUN</code>, <code><a href="BY.html">BY</a></code> is called internally to perform the computation. The resulting computations from each function are put into a list and recombined to produce the desired output format as controlled by the <code>return</code> argument.</p>
<p>When setting <code>parallel = TRUE</code> on a non-windows computer, aggregations will efficiently be parallelized at the column level using <code>mclapply</code> utilizing <code>mc.cores</code> cores.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>X</code> aggregated. If <code>X</code> is not a data frame it is coerced to one using <code><a href="quick-conversion.html">qDF</a></code> and then aggregated.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>(1) Additional arguments passed are not split by groups. Weighted aggregations with user defined functions should be done with <code><a href="fsummarise.html">fsummarise</a></code>, or using the <em>data.table</em> package.</p>
<p>(2) When the <code>w</code> argument is used, the weights are passed to all <a href="fast-statistical-functions.html">Fast Statistical Functions</a>. This may be undesirable in settings like <code>collapse::collap(data, ~ id, custom = list(fsum = ..., fmean = ...), w = ~ weights)</code> where we wish to aggregate some columns using the weighted mean, and others using a simple sum or another unweighted statistic. <!-- %Since many \link[=fast-statistical-functions]{Fast Statistical Functions} including \code{\link{fsum}} support weights, the above computes a weighted mean and a weighted sum. A couple of workarounds were outlined \href{https://github.com/SebKrantz/collapse/issues/96}{here}, but \emph{collapse} 1.5.0 incorporates an easy solution into \code{collap}: -->
Therefore it is possible to append <a href="fast-statistical-functions.html">Fast Statistical Functions</a> by <code>_uw</code> to yield an unweighted computation. So for the above example we can write: <code>collapse::collap(data, ~ id, custom = list(fsum_uw = ..., fmean = ...), w = ~ weights)</code> to get the weighted mean and the simple sum. <em>Note</em> that the <code>_uw</code> functions are not available for use outside collap. Thus one also needs to quote them when passing to the <code>FUN</code> or <code>catFUN</code> arguments, e.g. use <code>collap(data, ~ id, fmean, "fmode_uw", w = ~ weighs)</code>. <em>Note</em> also that it is never necessary for functions passed to <code>wFUN</code> to be appended like this, as the weights are never used to aggregate themselves.</p>
<p>(3) The dispatch between using optimized <a href="fast-statistical-functions.html">Fast Statistical Functions</a> performing grouped computations internally or calling <code>BY</code> to perform split-apply-combine computing is done by matching the function name against <code>.FAST_STAT_FUN</code>. Thus code like <code>collapse::collap(data, ~ id, collapse::fmedian)</code> does not yield an optimized computation, as <code>"collapse::fmedian" %!in% .FAST_STAT_FUN</code>. It is sufficient to write <code>collapse::collap(data, ~ id, "fmedian")</code> to get the desired result when the <em>collapse</em> namespace is not attached.</p>
<p><!-- %If you want to perform optimized computations with \code{collap} without loading the pacckage, load the functions beforehand as well, e.g. \code{fmedian &lt;- collapse::fmedian; data, ~ id, fmedian)}. Alternatively it is of course also possible to use \code{collapse::fmedian(collapse::fgroup_by(data, id))}, or something similar... --></p>
<p><!-- % \code{collap} by default (\code{keep.by = TRUE, keep.w = TRUE}) preserves all arguments passed to the \code{by} or \code{w} arguments, whether passed in a formula or externally. The names of externally passed vectors and lists are intelligently extracted. So it is possible to write \code{collap(iris, iris$Species)}, and obtain an aggregated data frame with two \code{Species} columns, whereas \code{collap(iris, ~ Species)} only has one \code{Species} column. Similarly for weight vectors passed to \code{w}. In this regard \code{collap} is more sophisticated than other \emph{collapse} functions where preservation of grouping and weight variables is restricted to formula use. For example \code{STD(iris, iris$Species)} does not preserve \code{Species} in the output, whereas \code{STD(iris, ~ Species)} does. This \code{collap} feature is there simply for convenience, for example sometimes a survey is disaggregated into several datasets, and this now allows easy pulling of identifiers or weights from other datasets for aggregations. If all information is available in one dataset, just using formulas is highly recommended. --></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="fsummarise.html">fsummarise</a></code>, <code><a href="BY.html">BY</a></code>, <a href="fast-statistical-functions.html">Fast Statistical Functions</a>, <a href="index.html">Collapse Overview</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## A Simple Introduction --------------------------------------</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          5.1         3.5          1.4         0.2  setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          4.9         3.0          1.4         0.2  setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          4.7         3.2          1.3         0.2  setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4          4.6         3.1          1.5         0.2  setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5          5.0         3.6          1.4         0.2  setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6          5.4         3.9          1.7         0.4  setosa</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span><span class="op">)</span>                                        <span class="co"># Default: FUN = fmean for numeric</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        5.006       3.428        1.462       0.246     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        5.936       2.770        4.260       1.326 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        6.588       2.974        5.552       2.026  virginica</span>
<span class="r-in"><span class="fu">collapv</span><span class="op">(</span><span class="va">iris</span>, <span class="fl">5</span><span class="op">)</span>                                               <span class="co"># Same using collapv</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        5.006       3.428        1.462       0.246     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        5.936       2.770        4.260       1.326 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        6.588       2.974        5.552       2.026  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, <span class="va">fmedian</span><span class="op">)</span>                               <span class="co"># Using the median</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1          5.0         3.4         1.50         0.2     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2          5.9         2.8         4.35         1.3 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3          6.5         3.0         5.55         2.0  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, <span class="va">fmedian</span>, keep.col.order <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>       <span class="co"># Groups in-front</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa          5.0         3.4         1.50         0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor          5.9         2.8         4.35         1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica          6.5         3.0         5.55         2.0</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="va">Sepal.Width</span> <span class="op">+</span> <span class="va">Petal.Width</span> <span class="op">~</span> <span class="va">Species</span>, <span class="va">fmedian</span><span class="op">)</span>     <span class="co"># Only '.Width' columns</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Width Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         3.4         0.2     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         2.8         1.3 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         3.0         2.0  virginica</span>
<span class="r-in"><span class="fu">collapv</span><span class="op">(</span><span class="va">iris</span>, <span class="fl">5</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>                               <span class="co"># Same using collapv</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Width Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       3.428       0.246     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       2.770       1.326 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       2.974       2.026  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fmedian</span><span class="op">)</span><span class="op">)</span>                  <span class="co"># Two functions</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmean.Sepal.Length fmedian.Sepal.Length fmean.Sepal.Width fmedian.Sepal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              5.006                  5.0             3.428                 3.4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              5.936                  5.9             2.770                 2.8</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3              6.588                  6.5             2.974                 3.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmean.Petal.Length fmedian.Petal.Length fmean.Petal.Width fmedian.Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              1.462                 1.50             0.246                 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2              4.260                 4.35             1.326                 1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3              5.552                 5.55             2.026                 2.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fmedian</span><span class="op">)</span>, return <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span> <span class="co"># Long format</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Function Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    fmean        5.006       3.428        1.462       0.246     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    fmean        5.936       2.770        4.260       1.326 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    fmean        6.588       2.974        5.552       2.026  virginica</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  fmedian        5.000       3.400        1.500       0.200     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  fmedian        5.900       2.800        4.350       1.300 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  fmedian        6.500       3.000        5.550       2.000  virginica</span>
<span class="r-in"><span class="fu">collapv</span><span class="op">(</span><span class="va">iris</span>, <span class="fl">5</span>, custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, fmedian <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>    <span class="co"># Custom aggregation</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        5.006       3.428         1.50         0.2     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        5.936       2.770         4.35         1.3 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        6.588       2.974         5.55         2.0  virginica</span>
<span class="r-in"><span class="fu">collapv</span><span class="op">(</span><span class="va">iris</span>, <span class="fl">5</span>, custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, fmedian <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,    <span class="co"># Raw output, no column reordering</span></span>
<span class="r-in">        return <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[1]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Sepal.Length Sepal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa        5.006       3.428</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor        5.936       2.770</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica        6.588       2.974</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [[2]]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa         1.50         0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor         4.35         1.3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica         5.55         2.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu">collapv</span><span class="op">(</span><span class="va">iris</span>, <span class="fl">5</span>, custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, fmedian <span class="op">=</span> <span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span>,    <span class="co"># A strange choice..</span></span>
<span class="r-in">        return <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Function Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        1        5.006       3.428           NA          NA     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        1        5.936       2.770           NA          NA versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        1        6.588       2.974           NA          NA  virginica</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4        2           NA          NA         1.50         0.2     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5        2           NA          NA         4.35         1.3 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6        2           NA          NA         5.55         2.0  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">Sepal.Length</span><span class="op">)</span>                    <span class="co"># Using Sepal.Length as weights, ..</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        250.3    3.447423     1.465202   0.2480224     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2        296.8    2.784063     4.290195   1.3352089 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3        329.4    2.987948     5.597116   2.0333030  virginica</span>
<span class="r-in"><span class="va">weights</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="efficient-programming.html">fnrow</a></span><span class="op">(</span><span class="va">iris</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="op">~</span> <span class="va">Species</span>, w <span class="op">=</span> <span class="va">weights</span><span class="op">)</span>                           <span class="co"># Some random weights..</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    weights Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 41.22987     4.974197    3.371781     1.447103   0.2331445     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 40.93461     5.896909    2.717216     4.178527   1.2963307 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 44.40987     6.561485    2.986780     5.529211   2.0364316  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, w <span class="op">=</span> <span class="va">weights</span><span class="op">)</span>                        <span class="co"># Note this behavior..</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species  weights Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa 41.22987     4.974197    3.371781     1.447103   0.2331445</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor 40.93461     5.896909    2.717216     4.178527   1.2963307</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica 44.40987     6.561485    2.986780     5.529211   2.0364316</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica</span>
<span class="r-in"><span class="fu">collap</span><span class="op">(</span><span class="va">iris</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span>, w <span class="op">=</span> <span class="va">weights</span>,</span>
<span class="r-in">       keep.by <span class="op">=</span> <span class="cn">FALSE</span>, keep.w <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Sepal.Length Sepal.Width Petal.Length Petal.Width    Species</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     4.974197    3.371781     1.447103   0.2331445     setosa</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2     5.896909    2.717216     4.178527   1.2963307 versicolor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3     6.561485    2.986780     5.529211   2.0364316  virginica</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Multi-Type Aggregation --------------------------------------</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">)</span>                                                    <span class="co"># World Development Panel Data</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date year decade     region     income  OECD PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1960   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1962-01-01 1961   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1963-01-01 1962   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1964-01-01 1963   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 1965-01-01 1964   1960 South Asia Low income FALSE    NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   LIFEEX GINI       ODA     POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 32.446   NA 116769997 8996973</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 32.962   NA 232080002 9169410</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 33.471   NA 112839996 9351441</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 33.971   NA 237720001 9543205</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 34.463   NA 295920013 9744781</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># Aggregate by country and decade</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date   year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1964.5   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1971-01-01 1974.5   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1981-01-01 1984.5   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1991-01-01 1994.5   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2001-01-01 2004.5   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 379.373 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, <span class="va">fmedian</span>, <span class="va">ffirst</span><span class="op">)</span><span class="op">)</span>       <span class="co"># Different functions</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date   year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1964.5   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1971-01-01 1974.5   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1981-01-01 1984.5   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1991-01-01 1994.5   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2001-01-01 2004.5   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA 34.7055   NA  234900002  9850550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA 39.8430   NA  246509995 12551055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA 46.4005   NA   48539999 12071250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA 53.1200   NA  285175003 17593192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 361.2596 58.0310   NA 2984469971 25190480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, cols <span class="op">=</span> <span class="va">is.numeric</span><span class="op">)</span><span class="op">)</span>     <span class="co"># Aggregate only numeric columns</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country   year decade decade    PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan 1964.5   1960   1960       NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan 1974.5   1970   1970       NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan 1984.5   1980   1980       NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan 1994.5   1990   1990       NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan 2004.5   2000   2000 379.3730 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan 2014.5   2010   2010 567.4047 63.0715   NA 5023859033 33741195</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span>           <span class="co"># Only the 5 series</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 379.3730 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 567.4047 63.0715   NA 5023859033 33741195</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span><span class="op">)</span><span class="op">)</span>         <span class="co"># Only GDP and life-expactancy</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 34.6908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 39.9053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 46.4176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 53.0097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 379.3730 58.0881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 567.4047 63.0715</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, <span class="va">fsum</span><span class="op">)</span><span class="op">)</span>   <span class="co"># Using the sum instead</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 346.908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 399.053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 464.176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 530.097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 3034.984 580.881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 5674.047 630.715</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">PCGDP</span> <span class="op">+</span> <span class="va">LIFEEX</span> <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, <span class="va">sum</span>,     <span class="co"># Same using base::sum -&gt; slower!</span></span>
<span class="r-in">            na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960    0.000 346.908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970    0.000 399.053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980    0.000 464.176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990    0.000 530.097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 3034.984 580.881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 5674.047 630.715</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">wlddev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>,<span class="st">"decade"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fsum</span>,        <span class="co"># Same, exploring different inputs</span></span>
<span class="r-in">            cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 346.908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 399.053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 464.176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 530.097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 3034.984 580.881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 5674.047 630.715</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span><span class="op">[</span><span class="fl">9</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>, <span class="va">wlddev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>,<span class="st">"decade"</span><span class="op">)</span><span class="op">]</span>, <span class="va">fsum</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 346.908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 399.053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 464.176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 530.097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 3034.984 580.881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 5674.047 630.715</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collapv</span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"country"</span>,<span class="st">"decade"</span><span class="op">)</span>, <span class="va">fsum</span><span class="op">)</span><span class="op">)</span>              <span class="co"># ..names/indices with collapv</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date  year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 19645   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1971-01-01 19745   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1981-01-01 19845   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1991-01-01 19945   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2001-01-01 20045   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      PCGDP  LIFEEX GINI         ODA       POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA 346.908   NA  2222889992  98867731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA 399.053   NA  2361699982 124518028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA 464.176   NA   716660007 122918537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA 530.097   NA  3172550003 169319030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 3034.984 580.881   NA 30540519608 248700217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collapv</span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>, <span class="va">fsum</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date  year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 19645   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1971-01-01 19745   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1981-01-01 19845   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1991-01-01 19945   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2001-01-01 20045   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      PCGDP  LIFEEX GINI         ODA       POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA 346.908   NA  2222889992  98867731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA 399.053   NA  2361699982 124518028</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA 464.176   NA   716660007 122918537</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA 530.097   NA  3172550003 169319030</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 3034.984 580.881   NA 30540519608 248700217</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="GRP.html">GRP</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span><span class="op">)</span>                            <span class="co"># Precomputing the grouping</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="va">g</span>, keep.by <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span>                        <span class="co"># This is slightly faster now</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date   year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1961-01-01 1964.5   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1971-01-01 1974.5   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1981-01-01 1984.5   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 1991-01-01 1994.5   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2001-01-01 2004.5   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 379.373 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="co"># Aggregate categorical data using not the mode but the last element</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, <span class="va">fmean</span>, <span class="va">flast</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country iso3c       date   year decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   AFG 1970-01-01 1964.5   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   AFG 1980-01-01 1974.5   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   AFG 1990-01-01 1984.5   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   AFG 2000-01-01 1994.5   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   AFG 2010-01-01 2004.5   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 379.373 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, catFUN <span class="op">=</span> <span class="va">flast</span>,         <span class="co"># Aggregate only categorical data</span></span>
<span class="r-in">            cols <span class="op">=</span> <span class="va">is_categorical</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country     country iso3c       date decade     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan Afghanistan   AFG 1970-01-01   1960 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan Afghanistan   AFG 1980-01-01   1970 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan Afghanistan   AFG 1990-01-01   1980 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan Afghanistan   AFG 2000-01-01   1990 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan Afghanistan   AFG 2010-01-01   2000 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan Afghanistan   AFG 2020-01-01   2010 South Asia Low income FALSE</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Weighted Aggregation ----------------------------------------</span></span>
<span class="r-in"><span class="co"># We aggregate to region level using population weights</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">region</span> <span class="op">+</span> <span class="va">year</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span><span class="op">)</span><span class="op">)</span>                <span class="co"># Takes weighted mean for numeric..</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   country iso3c       date year decade              region              income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   China   CHN 1961-01-01 1960   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   China   CHN 1962-01-01 1961   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   China   CHN 1963-01-01 1962   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   China   CHN 1964-01-01 1963   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   China   CHN 1965-01-01 1964   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    OECD    PCGDP   LIFEEX GINI       ODA        POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 FALSE 1313.760 48.20996   NA 764164132 1018832214</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 FALSE 1395.228 48.73451   NA 774544481 1021806689</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 FALSE 1463.441 49.39960   NA 915939856 1035694621</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 FALSE 1540.621 50.37529   NA 748978431 1060888744</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 FALSE 1665.385 51.57330   NA 619226983 1085690423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="co"># ..and weighted mode for categorical data. The weight vector is aggregated using fsum</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">region</span> <span class="op">+</span> <span class="va">year</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span>,                 <span class="co"># Aggregating weights using sum</span></span>
<span class="r-in">            wFUN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fsum</span>, <span class="va">fmax</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>                           <span class="co"># and max (corresponding to mode)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   country iso3c       date year decade              region              income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   China   CHN 1961-01-01 1960   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   China   CHN 1962-01-01 1961   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   China   CHN 1963-01-01 1962   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   China   CHN 1964-01-01 1963   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   China   CHN 1965-01-01 1964   1960 East Asia &amp; Pacific Upper middle income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    OECD    PCGDP   LIFEEX GINI       ODA   fsum.POP  fmax.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 FALSE 1313.760 48.20996   NA 764164132 1018832214 667070000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 FALSE 1395.228 48.73451   NA 774544481 1021806689 660330000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 FALSE 1463.441 49.39960   NA 915939856 1035694621 665770000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 FALSE 1540.621 50.37529   NA 748978431 1060888744 682335000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 FALSE 1665.385 51.57330   NA 619226983 1085690423 698355000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Multi-Function Aggregation ----------------------------------</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fnobs</span><span class="op">)</span>,     <span class="co"># Saving mean and Nobs</span></span>
<span class="r-in">            cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade fmean.PCGDP fnobs.PCGDP fmean.LIFEEX fnobs.LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960          NA           0      34.6908           10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970          NA           0      39.9053           10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980          NA           0      46.4176           10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990          NA           0      53.0097           10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000     379.373           8      58.0881           10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmean.GINI fnobs.GINI  fmean.ODA fnobs.ODA fmean.POP fnobs.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         NA          0  222288999        10   9886773        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         NA          0  236169998        10  12451803        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         NA          0   71666001        10  12291854        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         NA          0  317255000        10  16931903        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         NA          0 3054051961        10  24870022        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Same using base R -&gt; slower</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="va">mean</span>,</span>
<span class="r-in">                 Nobs <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span class="r-in">            cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade mean.PCGDP Nobs.PCGDP mean.LIFEEX Nobs.LIFEEX mean.GINI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960        NaN          0     34.6908          10       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970        NaN          0     39.9053          10       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980        NaN          0     46.4176          10       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990        NaN          0     53.0097          10       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000    379.373          8     58.0881          10       NaN</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Nobs.GINI   mean.ODA Nobs.ODA mean.POP Nobs.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         0  222288999       10  9886773       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         0  236169998       10 12451803       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3         0   71666001       10 12291854       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4         0  317255000       10 16931903       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5         0 3054051961       10 24870022       10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                       <span class="co"># List output format</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fnobs</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span>, return <span class="op">=</span> <span class="st">"list"</span><span class="op">)</span>, <span class="va">head</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fmean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade    PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960       NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970       NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980       NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990       NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 379.3730 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 567.4047 63.0715   NA 5023859033 33741195</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fnobs</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade PCGDP LIFEEX GINI ODA POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960     0     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970     0     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980     0     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990     0     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000     8     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010    10     10    0  10  10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Long output format</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fnobs</span><span class="op">)</span>, cols <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span>, return <span class="op">=</span> <span class="st">"long"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Function     country decade    PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    fmean Afghanistan   1960       NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    fmean Afghanistan   1970       NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    fmean Afghanistan   1980       NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    fmean Afghanistan   1990       NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    fmean Afghanistan   2000 379.3730 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    fmean Afghanistan   2010 567.4047 63.0715   NA 5023859033 33741195</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Also aggregating categorical data,</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fnobs</span><span class="op">)</span>, return <span class="op">=</span> <span class="st">"long_dupl"</span><span class="op">)</span><span class="op">)</span>          <span class="co"># and duplicating it 2 times</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Function     country iso3c       date   year decade     region     income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    fmean Afghanistan   AFG 1961-01-01 1964.5   1960 South Asia Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    fmean Afghanistan   AFG 1971-01-01 1974.5   1970 South Asia Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    fmean Afghanistan   AFG 1981-01-01 1984.5   1980 South Asia Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    fmean Afghanistan   AFG 1991-01-01 1994.5   1990 South Asia Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    fmean Afghanistan   AFG 2001-01-01 2004.5   2000 South Asia Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    OECD   PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 FALSE      NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 FALSE      NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 FALSE      NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 FALSE      NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 FALSE 379.373 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Now also using 2 functions on</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmean</span>, <span class="va">fnobs</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fmode</span>, <span class="va">flast</span><span class="op">)</span>,             <span class="co"># categorical data</span></span>
<span class="r-in">            keep.col.order <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade fmean.year fmean.PCGDP fmean.LIFEEX fmean.GINI fmean.ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960     1964.5          NA      34.6908         NA 222288999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970     1974.5          NA      39.9053         NA 236169998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmean.POP fnobs.year fnobs.PCGDP fnobs.LIFEEX fnobs.GINI fnobs.ODA fnobs.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   9886773         10           0           10          0        10        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  12451803         10           0           10          0        10        10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmode.iso3c fmode.date fmode.region fmode.income fmode.OECD flast.iso3c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         AFG 1961-01-01   South Asia   Low income      FALSE         AFG</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2         AFG 1971-01-01   South Asia   Low income      FALSE         AFG</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   flast.date flast.region flast.income flast.OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 1970-01-01   South Asia   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 1980-01-01   South Asia   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 4 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># More functions, string input,</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fmean"</span>,<span class="st">"fsum"</span>,<span class="st">"fnobs"</span>,<span class="st">"fsd"</span>,<span class="st">"fvar"</span><span class="op">)</span>,             <span class="co"># parallelized execution</span></span>
<span class="r-in">            <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fmode"</span>,<span class="st">"ffirst"</span>,<span class="st">"flast"</span>,<span class="st">"fndistinct"</span><span class="op">)</span>,           <span class="co"># (choose more than 1 cores,</span></span>
<span class="r-in">            parallel <span class="op">=</span> <span class="cn">TRUE</span>, mc.cores <span class="op">=</span> <span class="fl">1L</span>,                     <span class="co"># depending on your machine)</span></span>
<span class="r-in">            keep.col.order <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade fmean.year fmean.PCGDP fmean.LIFEEX fmean.GINI fmean.ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960     1964.5          NA      34.6908         NA 222288999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmean.POP fsum.year fsum.PCGDP fsum.LIFEEX fsum.GINI   fsum.ODA fsum.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   9886773     19645         NA     346.908        NA 2222889992 98867731</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fnobs.year fnobs.PCGDP fnobs.LIFEEX fnobs.GINI fnobs.ODA fnobs.POP fsd.year</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1         10           0           10          0        10        10  3.02765</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fsd.PCGDP fsd.LIFEEX fsd.GINI  fsd.ODA  fsd.POP fvar.year fvar.PCGDP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1        NA   1.490964       NA 80884369 637640.4  9.166667         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fvar.LIFEEX fvar.GINI     fvar.ODA     fvar.POP fmode.iso3c fmode.date</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    2.222975        NA 6.542281e+15 406585329709         AFG 1961-01-01</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fmode.region fmode.income fmode.OECD ffirst.iso3c ffirst.date ffirst.region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   South Asia   Low income      FALSE          AFG  1961-01-01    South Asia</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   ffirst.income ffirst.OECD flast.iso3c flast.date flast.region flast.income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    Low income       FALSE         AFG 1970-01-01   South Asia   Low income</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   flast.OECD fndistinct.iso3c fndistinct.date fndistinct.region</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      FALSE                1              10                 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fndistinct.income fndistinct.OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1                 1               1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 5 rows ]</span>
<span class="r-in"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Custom Aggregation ------------------------------------------</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Custom aggregation</span></span>
<span class="r-in">            custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">13</span>, fsd <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span>, fmode <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade fmode.income fmode.OECD fmean.PCGDP fsd.PCGDP fmean.LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960   Low income      FALSE          NA        NA      34.6908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970   Low income      FALSE          NA        NA      39.9053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980   Low income      FALSE          NA        NA      46.4176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990   Low income      FALSE          NA        NA      53.0097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000   Low income      FALSE    379.3730  53.66524      58.0881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010   Low income      FALSE    567.4047  18.07999      63.0715</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fsd.LIFEEX fmean.GINI  fmean.ODA fmean.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1.490964         NA  222288999   9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   1.738383         NA  236169998  12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   2.161460         NA   71666001  12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   1.695424         NA  317255000  16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   1.565630         NA 3054051961  24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   1.274644         NA 5023859033  33741195</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Using column names</span></span>
<span class="r-in">            custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="st">"PCGDP"</span>, fsd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"LIFEEX"</span>,<span class="st">"GINI"</span><span class="op">)</span>,</span>
<span class="r-in">                          flast <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country       date decade    PCGDP   LIFEEX GINI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan 1970-01-01   1960       NA 1.490964   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan 1980-01-01   1970       NA 1.738383   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan 1990-01-01   1980       NA 2.161460   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan 2000-01-01   1990       NA 1.695424   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan 2010-01-01   2000 379.3730 1.565630   NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan 2020-01-01   2010 567.4047 1.274644   NA</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># Weighted parallelized custom</span></span>
<span class="r-in">            custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, fsd <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span>,             <span class="co"># aggregation</span></span>
<span class="r-in">                          fmode <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span>,</span>
<span class="r-in">            wFUN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fsum</span>, <span class="va">fmax</span><span class="op">)</span>,</span>
<span class="r-in">            parallel <span class="op">=</span> <span class="cn">TRUE</span>, mc.cores <span class="op">=</span> <span class="fl">1L</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade fmode.income fmode.OECD fmean.PCGDP fsd.PCGDP fmean.LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960   Low income      FALSE          NA        NA     34.77716</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970   Low income      FALSE          NA        NA     40.00367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980   Low income      FALSE          NA        NA     46.32098</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990   Low income      FALSE          NA        NA     53.25897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000   Low income      FALSE    382.5583  51.11423     58.23630</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fsd.LIFEEX fmean.GINI  fmean.ODA  fsum.POP fmax.POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   1.413369         NA  223006447  98867731 10893776</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   1.643608         NA  236798314 124518028 13411056</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   2.061847         NA   70613923 122918537 13356511</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   1.556185         NA  306818649 169319030 20170844</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   1.476279         NA 3240143310 248700217 28394813</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu">collap</span><span class="op">(</span><span class="va">wlddev</span>, <span class="op">~</span> <span class="va">country</span> <span class="op">+</span> <span class="va">decade</span>,                         <span class="co"># No column reordering</span></span>
<span class="r-in">            custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, fsd <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">10</span>,</span>
<span class="r-in">                          fmode <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">8</span><span class="op">)</span>, w <span class="op">=</span> <span class="op">~</span> <span class="va">POP</span>,</span>
<span class="r-in">            wFUN <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">fsum</span>, <span class="va">fmax</span><span class="op">)</span>,</span>
<span class="r-in">            parallel <span class="op">=</span> <span class="cn">TRUE</span>, mc.cores <span class="op">=</span> <span class="fl">1L</span>, keep.col.order <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade  fsum.POP fmax.POP fmean.PCGDP fmean.LIFEEX fmean.GINI</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960  98867731 10893776          NA     34.77716         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970 124518028 13411056          NA     40.00367         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980 122918537 13356511          NA     46.32098         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990 169319030 20170844          NA     53.25897         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 248700217 28394813    382.5583     58.23630         NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    fmean.ODA fsd.PCGDP fsd.LIFEEX fmode.income fmode.OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  223006447        NA   1.413369   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  236798314        NA   1.643608   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   70613923        NA   2.061847   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  306818649        NA   1.556185   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 3240143310  51.11423   1.476279   Low income      FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"></span>
<span class="r-in"> </span>
<span class="r-in"><span class="co">## Piped Use --------------------------------------------------</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span> <span class="co"># Note: Used because |&gt; is not available on older R versions</span></span>
<span class="r-in"><span class="va">iris</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">Species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">collapg</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      Species Sepal.Length Sepal.Width Petal.Length Petal.Width</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1     setosa        5.006       3.428        1.462       0.246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 versicolor        5.936       2.770        4.260       1.326</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  virginica        6.588       2.974        5.552       2.026</span>
<span class="r-in"><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">decade</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">collapg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade iso3c       date   year     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960   AFG 1961-01-01 1964.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970   AFG 1971-01-01 1974.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980   AFG 1981-01-01 1984.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990   AFG 1991-01-01 1994.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000   AFG 2001-01-01 2004.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1      NA 34.6908   NA  222288999  9886773</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2      NA 39.9053   NA  236169998 12451803</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3      NA 46.4176   NA   71666001 12291854</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4      NA 53.0097   NA  317255000 16931903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 379.373 58.0881   NA 3054051961 24870022</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">region</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">collapg</span><span class="op">(</span>w <span class="op">=</span> <span class="va">POP</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                region year        POP country iso3c       date decade</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 East Asia &amp; Pacific 1960 1018832214   China   CHN 1961-01-01   1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 East Asia &amp; Pacific 1961 1021806689   China   CHN 1962-01-01   1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 East Asia &amp; Pacific 1962 1035694621   China   CHN 1963-01-01   1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 East Asia &amp; Pacific 1963 1060888744   China   CHN 1964-01-01   1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 East Asia &amp; Pacific 1964 1085690423   China   CHN 1965-01-01   1960</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                income  OECD    PCGDP   LIFEEX GINI       ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Upper middle income FALSE 1313.760 48.20996   NA 764164132</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Upper middle income FALSE 1395.228 48.73451   NA 774544481</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Upper middle income FALSE 1463.441 49.39960   NA 915939856</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Upper middle income FALSE 1540.621 50.37529   NA 748978431</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Upper middle income FALSE 1665.385 51.57330   NA 619226983</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">decade</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">collapg</span><span class="op">(</span><span class="va">fmedian</span>, <span class="va">flast</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade iso3c       date   year     region     income  OECD</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960   AFG 1970-01-01 1964.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970   AFG 1980-01-01 1974.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980   AFG 1990-01-01 1984.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990   AFG 2000-01-01 1994.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000   AFG 2010-01-01 2004.5 South Asia Low income FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      PCGDP  LIFEEX GINI        ODA      POP</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1       NA 34.7055   NA  234900002  9850550</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2       NA 39.8430   NA  246509995 12551055</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3       NA 46.4005   NA   48539999 12071250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4       NA 53.1200   NA  285175003 17593192</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 361.2596 58.0310   NA 2984469971 25190480</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [ reached 'max' / getOption("max.print") -- omitted 1 rows ]</span>
<span class="r-in"><span class="va">wlddev</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="GRP.html">fgroup_by</a></span><span class="op">(</span><span class="va">country</span>, <span class="va">decade</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span class="r-in">  <span class="fu">collapg</span><span class="op">(</span>custom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fmean <span class="op">=</span> <span class="fl">9</span><span class="op">:</span><span class="fl">12</span>, fmode <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">7</span>, flast <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       country decade       date decade     region     income    PCGDP  LIFEEX</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Afghanistan   1960 1970-01-01   1960 South Asia Low income       NA 34.6908</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Afghanistan   1970 1980-01-01   1970 South Asia Low income       NA 39.9053</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Afghanistan   1980 1990-01-01   1980 South Asia Low income       NA 46.4176</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 Afghanistan   1990 2000-01-01   1990 South Asia Low income       NA 53.0097</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 Afghanistan   2000 2010-01-01   2000 South Asia Low income 379.3730 58.0881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 Afghanistan   2010 2020-01-01   2010 South Asia Low income 567.4047 63.0715</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   GINI        ODA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   NA  222288999</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   NA  236169998</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3   NA   71666001</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4   NA  317255000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5   NA 3054051961</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6   NA 5023859033</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer></div>

  


  

  </body></html>

