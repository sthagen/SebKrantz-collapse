<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><link rel="shortcut icon" href="https://sebkrantz.github.io/collapse/favicon.ico" type="image/x-icon">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fast (Weighted) F-test for Linear Models (with Factors) — fFtest • collapse</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fast (Weighted) F-test for Linear Models (with Factors) — fFtest"><meta property="og:description" content="fFtest computes an R-squared based F-test for the exclusion of the variables in exc, where the full (unrestricted) model is defined by variables supplied to both exc and X. The test is efficient and designed for cases where both exc and X may contain multiple factors and continuous variables."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" class="external-link">Blog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/collapse_R" class="external-link">
    <span class="fa fa-twitter"></span>

  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast (Weighted) F-test for Linear Models (with Factors)</h1>

    <div class="hidden name"><code>fFtest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fFtest</code> computes an R-squared based F-test for the exclusion of the variables in <code>exc</code>, where the full (unrestricted) model is defined by variables supplied to both <code>exc</code> and <code>X</code>. The test is efficient and designed for cases where both <code>exc</code> and <code>X</code> may contain multiple factors and continuous variables.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">fFtest</span><span class="op">(</span><span class="va">y</span>, <span class="va">exc</span>, X <span class="op">=</span> <span class="cn">NULL</span>, w <span class="op">=</span> <span class="cn">NULL</span>, full.df <span class="op">=</span> <span class="cn">TRUE</span>, <span class="va">...</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>a numeric vector: The dependent variable.</p></dd>
<dt>exc</dt>
<dd><p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: Variables to test / exclude.</p></dd>
<dt>X</dt>
<dd><p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: Covariates to include in both the restricted (without <code>exc</code>) and unrestricted model. If left empty (<code>X = NULL</code>), the test amounts to the F-test of the regression of <code>y</code> on <code>exc</code>.</p></dd>
<dt>w</dt>
<dd><p>numeric. A vector of (frequency) weights.</p></dd>
<dt>full.df</dt>
<dd><p>logical. If <code>TRUE</code> (default), the degrees of freedom are calculated as if both restricted and unrestricted models were estimated using <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> (i.e. as if factors were expanded to matrices of dummies). <code>FALSE</code> only uses one degree of freedom per factor.</p></dd>
<dt>...</dt>
<dd><p>other arguments passed to <code>fhdwithin</code>. Sensible options might be the <code>lm.method</code> argument or further control parameters to <code><a href="https://lrberge.github.io/fixest/reference/demean.html" class="external-link">fixest::demean</a></code>, the workhorse function underlying <code>fhdwithin</code> for higher-order centering tasks.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Factors and continuous regressors are efficiently projected out using <code><a href="fHDbetween_fHDwithin.html">fhdwithin</a></code>, and the option <code>full.df</code> regulates whether a degree of freedom is subtracted for each used factor level (equivalent to dummy-variable estimator / expanding factors), or only one degree of freedom per factor (treating factors as variables). The test automatically removes missing values and considers only the complete cases of <code>y, exc</code> and <code>X</code>. Unused factor levels in <code>exc</code> and <code>X</code> are dropped.</p>
<p><em>Note</em> that an intercept is always added by <code><a href="fHDbetween_fHDwithin.html">fhdwithin</a></code>, so it is not necessary to include an intercept in data supplied to <code>exc</code> / <code>X</code>.</p>
    </div>
    <div id="value">
    <h2>Value</h2>
    <p>A 5 x 3 numeric matrix of statistics. The columns contain statistics:</p><ol><li><p>the R-squared of the model</p></li>
<li><p>the numerator degrees of freedom i.e. the number of variables (k) and used factor levels if <code>full.df = TRUE</code></p></li>
<li><p>the denominator degrees of freedom: N - k - 1.</p></li>
<li><p>the F-statistic</p></li>
<li><p>the corresponding P-value</p></li>
</ol><p>The rows show these statistics for:</p><ol><li><p>the Full (unrestricted) Model (<code>y ~ exc + X</code>)</p></li>
<li><p>the Restricted Model (<code>y ~ X</code>)</p></li>
<li><p>the Exclusion Restriction of <code>exc</code>. The R-squared shown is simply the difference of the full and restricted R-Squared's, not the R-Squared of the model <code>y ~ exc</code>.</p></li>
</ol><p>If <code>X = NULL</code>, only a vector of the same 5 statistics testing the model (<code>y ~ exc</code>) is shown.
<!-- %%  ~Describe the value returned --><!-- %%  If it is a LIST, use --><!-- %%  \item{comp1 }{Description of 'comp1'} --><!-- %%  \item{comp2 }{Description of 'comp2'} --><!-- %% \dots --></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="flm.html">flm</a></code>, <code><a href="fHDbetween_fHDwithin.html">fhdwithin</a></code>, <a href="data-transformations.html">Data Transformations</a>, <a href="index.html">Collapse Overview</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co">## We could use fFtest as a seasonality test:</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">AirPassengers</span>, <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">cycle</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>         <span class="co"># Testing for level-seasonality</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   R-Sq.     DF1     DF2 F-Stat. P-value </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.106      11     132   1.424   0.169 </span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">AirPassengers</span>, <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">cycle</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span>,         <span class="co"># Seasonality test around a cubic trend</span></span>
<span class="r-in">        <span class="fu"><a href="https://rdrr.io/r/stats/poly.html" class="external-link">poly</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    R-Sq. DF1 DF2 F-Stat. P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model         0.965  14 129 250.585   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model   0.862   3 140 291.593   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.    0.102  11 129  33.890   0.000</span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="fu"><a href="fdiff.html">fdiff</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span>, <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">cycle</a></span><span class="op">(</span><span class="va">AirPassengers</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Seasonality in first-difference</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   R-Sq.     DF1     DF2 F-Stat. P-value </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.749      11     131  35.487   0.000 </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## A more classical example with only continuous variables</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>,<span class="st">"vs"</span><span class="op">)</span><span class="op">]</span>, <span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>,<span class="st">"carb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   R-Sq. DF1 DF2 F-Stat. P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model        0.750   4  27  20.261   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model  0.605   2  29  22.175   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.   0.145   2  27   7.858   0.002</span>
<span class="r-in"> </span>
<span class="r-in"><span class="co">## Now encoding cyl and vs as factors</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="fu"><a href="dapply.html">dapply</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cyl"</span>,<span class="st">"vs"</span><span class="op">)</span><span class="op">]</span>, <span class="va">qF</span><span class="op">)</span>, <span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>,<span class="st">"carb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                   R-Sq. DF1 DF2 F-Stat. P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model        0.756   5  26  16.140   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model  0.605   2  29  22.175   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.   0.152   3  26   5.395   0.005</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Using iris data: A factor and a continuous variable excluded</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">iris</span><span class="op">$</span><span class="va">Sepal.Length</span>, <span class="va">iris</span><span class="op">[</span><span class="fl">4</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span>, <span class="va">iris</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    R-Sq. DF1 DF2 F-Stat. P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model         0.867   5 144 188.251   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model   0.840   2 147 386.386   0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.    0.027   3 144   9.816   0.000</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## Testing the significance of country-FE in regression of GDP on life expectancy</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">PCGDP</span>, <span class="va">wlddev</span><span class="op">$</span><span class="va">iso3c</span>, <span class="va">wlddev</span><span class="op">$</span><span class="va">LIFEEX</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     R-Sq.  DF1  DF2  F-Stat.  P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model          0.873  199 8822  304.661    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model    0.320    1 9020 4253.335    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.     0.553  198 8822  193.803    0.000</span>
<span class="r-in"> </span>
<span class="r-in"><span class="co">## Ok, country-FE are significant, what about adding time-FE</span></span>
<span class="r-in"><span class="fu">fFtest</span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">PCGDP</span>, <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="va">wlddev</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>, <span class="va">wlddev</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"LIFEEX"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                     R-Sq.  DF1  DF2  F-Stat.  P-Value</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Full Model          0.894  258 8763  286.130    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Restricted Model    0.873  199 8822  304.661    0.000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Exclusion Rest.     0.021   59 8763   29.280    0.000</span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Same test done using lm:</span></span>
<span class="r-in"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="programming.html">na_omit</a></span><span class="op">(</span><span class="fu"><a href="select_replace_vars.html">get_vars</a></span><span class="op">(</span><span class="va">wlddev</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"iso3c"</span>,<span class="st">"year"</span>,<span class="st">"PCGDP"</span>,<span class="st">"LIFEEX"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">PCGDP</span> <span class="op">~</span> <span class="va">LIFEEX</span> <span class="op">+</span> <span class="va">iso3c</span> <span class="op">+</span> <span class="fu"><a href="qF.html">qF</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span>, <span class="va">data</span><span class="op">)</span></span>
<span class="r-in"><span class="va">rest</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">PCGDP</span> <span class="op">~</span> <span class="va">LIFEEX</span> <span class="op">+</span> <span class="va">iso3c</span>, <span class="va">data</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">rest</span>, <span class="va">full</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Analysis of Variance Table</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 1: PCGDP ~ LIFEEX + iso3c</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Model 2: PCGDP ~ LIFEEX + iso3c + qF(year)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Res.Df        RSS Df  Sum of Sq     F    Pr(&gt;F)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   8822 3.0044e+11                                  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2   8763 2.5097e+11 59 4.9475e+10 29.28 &lt; 2.2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>






  </body></html>

