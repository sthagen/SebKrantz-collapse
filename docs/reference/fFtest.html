<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head><link rel="shortcut icon" href="https://sebkrantz.github.io/collapse/favicon.ico" type="image/x-icon">
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast (Weighted) F-test for Linear Models (with Factors) — fFtest • collapse</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast (Weighted) F-test for Linear Models (with Factors) — fFtest" />
<meta property="og:description" content="fFtest computes an R-squared based F-test for the exclusion of the variables in exc, where the full (unrestricted) model is defined by variables supplied to both exc and X. The test is efficient and designed for cases where both exc and X may contain multiple factors and continuous variables." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" target="_blank">Blog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/collapse_R" target="_blank">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" target="_blank">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast (Weighted) F-test for Linear Models (with Factors)</h1>
    
    <div class="hidden name"><code>fFtest.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fFtest</code> computes an R-squared based F-test for the exclusion of the variables in <code>exc</code>, where the full (unrestricted) model is defined by variables supplied to both <code>exc</code> and <code>X</code>. The test is efficient and designed for cases where both <code>exc</code> and <code>X</code> may contain multiple factors and continuous variables.</p>
    </div>

    <pre class="usage"><span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>y</span>, <span class='va'>exc</span>, X <span class='op'>=</span> <span class='cn'>NULL</span>, w <span class='op'>=</span> <span class='cn'>NULL</span>, full.df <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>a numeric vector: The dependent variable.</p></td>
    </tr>
    <tr>
      <th>exc</th>
      <td><p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: Variables to test / exclude.</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>a numeric vector, factor, numeric matrix or list / data frame of numeric vectors and/or factors: Covariates to include in both the restricted (without <code>exc</code>) and unrestricted model. If left empty (<code>X = NULL</code>), the test amounts to the F-test of the regression of <code>y</code> on <code>exc</code>.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>numeric. A vector of (frequency) weights.</p></td>
    </tr>
    <tr>
      <th>full.df</th>
      <td><p>logical. If <code>TRUE</code> (default), the degrees of freedom are calculated as if both restricted and unrestricted models were estimated using <code><a href='https://rdrr.io/r/stats/lm.html'>lm()</a></code> (i.e. as if factors were expanded to matrices of dummies). <code>FALSE</code> only uses one degree of freedom per factor.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>other arguments passed to <code>fhdwithin</code>. Sensible options might be the <code>lm.method</code> argument or further control parameters to <code><a href='https://lrberge.github.io/fixest/reference/demean.html'>fixest::demean</a></code>, the workhorse function underlying <code>fhdwithin</code> for higher-order centering tasks.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Factors and continuous regressors are efficiently projected out using <code><a href='fhdbetween, fhdwithin.html'>fhdwithin</a></code>, and the option <code>full.df</code> regulates whether a degree of freedom is subtracted for each used factor level (equivalent to dummy-variable estimator / expanding factors), or only one degree of freedom per factor (treating factors as variables). The test automatically removes missing values and considers only the complete cases of <code>y, exc</code> and <code>X</code>. Unused factor levels in <code>exc</code> and <code>X</code> are dropped.</p>
<p><em>Note</em> that an intercept is always added by <code><a href='fhdbetween, fhdwithin.html'>fhdwithin</a></code>, so it is not necessary to include an intercept in data supplied to <code>exc</code> / <code>X</code>.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A 5 x 3 numeric matrix of statistics. The columns contain statistics:</p><ol>
<li><p>the R-squared of the model</p></li>
<li><p>the numerator degrees of freedom i.e. the number of variables (k) and used factor levels if <code>full.df = TRUE</code></p></li>
<li><p>the denominator degrees of freedom: N - k - 1.</p></li>
<li><p>the F-statistic</p></li>
<li><p>the corresponding P-value</p></li>
</ol><p>The rows show these statistics for:</p><ol>
<li><p>the Full (unrestricted) Model (<code>y ~ exc + X</code>)</p></li>
<li><p>the Restricted Model (<code>y ~ X</code>)</p></li>
<li><p>the Exclusion Restriction of <code>exc</code>. The R-squared shown is simply the difference of the full and restricted R-Squared's, not the R-Squared of the model <code>y ~ exc</code>.</p></li>
</ol><p>If <code>X = NULL</code>, only a vector of the same 5 statistics testing the model (<code>y ~ exc</code>) is shown.</p>
<p><!-- %%  ~Describe the value returned -->
<!-- %%  If it is a LIST, use -->
<!-- %%  \item{comp1 }{Description of 'comp1'} -->
<!-- %%  \item{comp2 }{Description of 'comp2'} -->
<!-- %% \dots --></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='flm.html'>flm</a></code>, <code><a href='fhdbetween, fhdwithin.html'>fhdwithin</a></code>, <a href='data-transformations.html'>Data Transformations</a>, <a href='index.html'>Collapse Overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## We could use fFtest as a seasonality test:</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>AirPassengers</span>, <span class='fu'><a href='qF, qG, finteraction.html'>qF</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/time.html'>cycle</a></span><span class='op'>(</span><span class='va'>AirPassengers</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>         <span class='co'># Testing for level-seasonality</span>
</div><div class='output co'>#&gt;   R-Sq.     DF1     DF2 F-Stat. P-value 
#&gt;   0.106      11     132   1.424   0.169 </div><div class='input'><span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>AirPassengers</span>, <span class='fu'><a href='qF, qG, finteraction.html'>qF</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/time.html'>cycle</a></span><span class='op'>(</span><span class='va'>AirPassengers</span><span class='op'>)</span><span class='op'>)</span>,         <span class='co'># Seasonality test around a cubic trend</span>
        <span class='fu'><a href='https://rdrr.io/r/stats/poly.html'>poly</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq_along</a></span><span class='op'>(</span><span class='va'>AirPassengers</span><span class='op'>)</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                    R-Sq. DF1 DF2 F-Stat. P-Value
#&gt; Full Model         0.965  14 129 250.585   0.000
#&gt; Restricted Model   0.862   3 140 291.593   0.000
#&gt; Exclusion Rest.    0.102  11 129  33.890   0.000</div><div class='input'><span class='fu'>fFtest</span><span class='op'>(</span><span class='fu'><a href='fdiff.html'>fdiff</a></span><span class='op'>(</span><span class='va'>AirPassengers</span><span class='op'>)</span>, <span class='fu'><a href='qF, qG, finteraction.html'>qF</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/time.html'>cycle</a></span><span class='op'>(</span><span class='va'>AirPassengers</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>  <span class='co'># Seasonality in first-difference</span>
</div><div class='output co'>#&gt;   R-Sq.     DF1     DF2 F-Stat. P-value 
#&gt;   0.749      11     131  35.487   0.000 </div><div class='input'>
<span class='co'>## A more classical example with only continuous variables</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>$</span><span class='va'>mpg</span>, <span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cyl"</span>,<span class='st'>"vs"</span><span class='op'>)</span><span class='op'>]</span>, <span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"hp"</span>,<span class='st'>"carb"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                   R-Sq. DF1 DF2 F-Stat. P-Value
#&gt; Full Model        0.750   4  27  20.261   0.000
#&gt; Restricted Model  0.605   2  29  22.175   0.000
#&gt; Exclusion Rest.   0.145   2  27   7.858   0.002</div><div class='input'> 
<span class='co'>## Now encoding cyl and vs as factors</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>$</span><span class='va'>mpg</span>, <span class='fu'><a href='dapply.html'>dapply</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"cyl"</span>,<span class='st'>"vs"</span><span class='op'>)</span><span class='op'>]</span>, <span class='va'>qF</span><span class='op'>)</span>, <span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"hp"</span>,<span class='st'>"carb"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                   R-Sq. DF1 DF2 F-Stat. P-Value
#&gt; Full Model        0.756   5  26  16.140   0.000
#&gt; Restricted Model  0.605   2  29  22.175   0.000
#&gt; Exclusion Rest.   0.152   3  26   5.395   0.005</div><div class='input'>
<span class='co'>## Using iris data: A factor and a continuous variable excluded</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>iris</span><span class='op'>$</span><span class='va'>Sepal.Length</span>, <span class='va'>iris</span><span class='op'>[</span><span class='fl'>4</span><span class='op'>:</span><span class='fl'>5</span><span class='op'>]</span>, <span class='va'>iris</span><span class='op'>[</span><span class='fl'>2</span><span class='op'>:</span><span class='fl'>3</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                    R-Sq. DF1 DF2 F-Stat. P-Value
#&gt; Full Model         0.867   5 144 188.251   0.000
#&gt; Restricted Model   0.840   2 147 386.386   0.000
#&gt; Exclusion Rest.    0.027   3 144   9.816   0.000</div><div class='input'>
<span class='co'>## Testing the significance of country-FE in regression of GDP on life expectancy</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>wlddev</span><span class='op'>$</span><span class='va'>PCGDP</span>, <span class='va'>wlddev</span><span class='op'>$</span><span class='va'>iso3c</span>, <span class='va'>wlddev</span><span class='op'>$</span><span class='va'>LIFEEX</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                     R-Sq.  DF1  DF2  F-Stat.  P-Value
#&gt; Full Model          0.873  199 8822  304.661    0.000
#&gt; Restricted Model    0.320    1 9020 4253.335    0.000
#&gt; Exclusion Rest.     0.553  198 8822  193.803    0.000</div><div class='input'> 
<span class='co'>## Ok, country-FE are significant, what about adding time-FE</span>
<span class='fu'>fFtest</span><span class='op'>(</span><span class='va'>wlddev</span><span class='op'>$</span><span class='va'>PCGDP</span>, <span class='fu'><a href='qF, qG, finteraction.html'>qF</a></span><span class='op'>(</span><span class='va'>wlddev</span><span class='op'>$</span><span class='va'>year</span><span class='op'>)</span>, <span class='va'>wlddev</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3c"</span>,<span class='st'>"LIFEEX"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                     R-Sq.  DF1  DF2  F-Stat.  P-Value
#&gt; Full Model          0.894  258 8763  286.130    0.000
#&gt; Restricted Model    0.873  199 8822  304.661    0.000
#&gt; Exclusion Rest.     0.021   59 8763   29.280    0.000</div><div class='input'>
<span class='co'># Same test done using lm:</span>
<span class='va'>data</span> <span class='op'>&lt;-</span> <span class='fu'><a href='small-helper.html'>na_omit</a></span><span class='op'>(</span><span class='fu'><a href='fselect, get_vars, add_vars.html'>get_vars</a></span><span class='op'>(</span><span class='va'>wlddev</span>, <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"iso3c"</span>,<span class='st'>"year"</span>,<span class='st'>"PCGDP"</span>,<span class='st'>"LIFEEX"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>full</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>PCGDP</span> <span class='op'>~</span> <span class='va'>LIFEEX</span> <span class='op'>+</span> <span class='va'>iso3c</span> <span class='op'>+</span> <span class='fu'><a href='qF, qG, finteraction.html'>qF</a></span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>, <span class='va'>data</span><span class='op'>)</span>
<span class='va'>rest</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>PCGDP</span> <span class='op'>~</span> <span class='va'>LIFEEX</span> <span class='op'>+</span> <span class='va'>iso3c</span>, <span class='va'>data</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/stats/anova.html'>anova</a></span><span class='op'>(</span><span class='va'>rest</span>, <span class='va'>full</span><span class='op'>)</span>
</div><div class='output co'>#&gt; Analysis of Variance Table
#&gt; 
#&gt; Model 1: PCGDP ~ LIFEEX + iso3c
#&gt; Model 2: PCGDP ~ LIFEEX + iso3c + qF(year)
#&gt;   Res.Df        RSS Df  Sum of Sq     F    Pr(&gt;F)    
#&gt; 1   8822 3.0044e+11                                  
#&gt; 2   8763 2.5097e+11 59 4.9475e+10 29.28 &lt; 2.2e-16 ***
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


