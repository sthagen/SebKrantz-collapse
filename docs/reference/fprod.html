<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head><link rel="shortcut icon" href="https://sebkrantz.github.io/collapse/favicon.ico" type="image/x-icon">
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast (Grouped, Weighted) Product for Matrix-Like Objects — fprod • collapse</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast (Grouped, Weighted) Product for Matrix-Like Objects — fprod" />
<meta property="og:description" content="fprod is a generic function that computes the (column-wise) product of all values in x, (optionally) grouped by g and/or weighted by w. The TRA argument can further be used to transform x using its (grouped, weighted) product." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.6.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" target="_blank">Blog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/collapse_R" target="_blank">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" target="_blank">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast (Grouped, Weighted) Product for Matrix-Like Objects</h1>
    
    <div class="hidden name"><code>fprod.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>fprod</code> is a generic function that computes the (column-wise) product of all values in <code>x</code>, (optionally) grouped by <code>g</code> and/or weighted by <code>w</code>. The <code><a href='TRA.html'>TRA</a></code> argument can further be used to transform <code>x</code> using its (grouped, weighted) product.</p>
    </div>

    <pre class="usage"><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for default</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>x</span>, g <span class='op'>=</span> <span class='cn'>NULL</span>, w <span class='op'>=</span> <span class='cn'>NULL</span>, TRA <span class='op'>=</span> <span class='cn'>NULL</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span>,
      use.g.names <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for matrix</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>x</span>, g <span class='op'>=</span> <span class='cn'>NULL</span>, w <span class='op'>=</span> <span class='cn'>NULL</span>, TRA <span class='op'>=</span> <span class='cn'>NULL</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span>,
      use.g.names <span class='op'>=</span> <span class='cn'>TRUE</span>, drop <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for data.frame</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>x</span>, g <span class='op'>=</span> <span class='cn'>NULL</span>, w <span class='op'>=</span> <span class='cn'>NULL</span>, TRA <span class='op'>=</span> <span class='cn'>NULL</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span>,
      use.g.names <span class='op'>=</span> <span class='cn'>TRUE</span>, drop <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for grouped_df</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>x</span>, w <span class='op'>=</span> <span class='cn'>NULL</span>, TRA <span class='op'>=</span> <span class='cn'>NULL</span>, na.rm <span class='op'>=</span> <span class='cn'>TRUE</span>,
      use.g.names <span class='op'>=</span> <span class='cn'>FALSE</span>, keep.group_vars <span class='op'>=</span> <span class='cn'>TRUE</span>, keep.w <span class='op'>=</span> <span class='cn'>TRUE</span>, <span class='va'>...</span><span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>a numeric vector, matrix, data frame or grouped data frame (class 'grouped_df').</p></td>
    </tr>
    <tr>
      <th>g</th>
      <td><p>a factor, <code><a href='GRP, fgroup_by.html'>GRP</a></code> object, atomic vector (internally converted to factor) or a list of vectors / factors (internally converted to a <code><a href='GRP, fgroup_by.html'>GRP</a></code> object) used to group <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>a numeric vector of (non-negative) weights, may contain missing values.</p></td>
    </tr>
    <tr>
      <th>TRA</th>
      <td><p>an integer or quoted operator indicating the transformation to perform:
1 - "replace_fill"     |     2 - "replace"     |     3 - "-"     |     4 - "-+"     |     5 - "/"     |     6 - "%"     |     7 - "+"     |     8 - "*"     |     9 - "%%"     |     10 - "-%%". See <code><a href='TRA.html'>TRA</a></code>.</p></td>
    </tr>
    <tr>
      <th>na.rm</th>
      <td><p>logical. Skip missing values in <code>x</code>. Defaults to <code>TRUE</code> and implemented at very little computational cost. If <code>na.rm = FALSE</code> a <code>NA</code> is returned when encountered.</p></td>
    </tr>
    <tr>
      <th>use.g.names</th>
      <td><p>logical. Make group-names and add to the result as names (default method) or row-names (matrix and data frame methods). No row-names are generated for <em>data.table</em>'s.</p></td>
    </tr>
    <tr>
      <th>drop</th>
      <td><p><em>matrix and data.frame method:</em> Logical. <code>TRUE</code> drops dimensions and returns an atomic vector if <code>g = NULL</code> and <code>TRA = NULL</code>.</p></td>
    </tr>
    <tr>
      <th>keep.group_vars</th>
      <td><p><em>grouped_df method:</em> Logical. <code>FALSE</code> removes grouping variables after computation.</p></td>
    </tr>
    <tr>
      <th>keep.w</th>
      <td><p><em>grouped_df method:</em> Logical. Retain product of weighting variable after computation (if contained in <code>grouped_df</code>).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>arguments to be passed to or from other methods.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Non-grouped product computations internally utilize long-doubles in C++, for additional numeric precision.</p>
<p>Missing-value removal as controlled by the <code>na.rm</code> argument is done very efficiently by simply skipping them in the computation (thus setting <code>na.rm = FALSE</code> on data with no missing values doesn't give extra speed). Large performance gains can nevertheless be achieved in the presence of missing values if <code>na.rm = FALSE</code>, since then the corresponding computation is terminated once a <code>NA</code> is encountered and <code>NA</code> is returned (unlike <code><a href='https://rdrr.io/r/base/prod.html'>prod</a></code> which just runs through without any checks).</p>
<p>This all seamlessly generalizes to grouped computations, which are performed in a single pass (without splitting the data) and therefore extremely fast.</p>
<p>The weighted product is computed as <code><a href='https://rdrr.io/r/base/prod.html'>prod(x * w)</a></code>. If <code>na.rm = TRUE</code>, missing values will be removed from both <code>x</code> and <code>w</code> i.e. utilizing only <code>x[complete.cases(x,w)]</code> and <code>w[complete.cases(x,w)]</code>.</p>
<p>When applied to data frames with groups or <code>drop = FALSE</code>, <code>fprod</code> preserves all column attributes (such as variable labels) but does not distinguish between classed and unclassed objects. The attributes of the data frame itself are also preserved.</p>
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The (<code>w</code> weighted) product of <code>x</code>, grouped by <code>g</code>, or (if <code><a href='TRA.html'>TRA</a></code> is used) <code>x</code> transformed by its product, grouped by <code>g</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='fsum.html'>fsum</a></code>, <a href='fast-statistical-functions.html'>Fast Statistical Functions</a>, <a href='index.html'>Collapse Overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'>## default vector method</span>
<span class='va'>mpg</span> <span class='op'>&lt;-</span> <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>mpg</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span><span class='op'>)</span>                         <span class='co'># Simple product</span>
</div><div class='output co'>#&gt; [1] 1.264241e+41</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, w <span class='op'>=</span> <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>hp</span><span class='op'>)</span>          <span class='co'># Weighted product</span>
</div><div class='output co'>#&gt; [1] 8.870404e+108</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, TRA <span class='op'>=</span> <span class='st'>"/"</span><span class='op'>)</span>              <span class='co'># Simple transformation: Divide by product</span>
</div><div class='output co'>#&gt;  [1] 1.661076e-40 1.661076e-40 1.803454e-40 1.692716e-40 1.479149e-40
#&gt;  [6] 1.431690e-40 1.131114e-40 1.930012e-40 1.803454e-40 1.518698e-40
#&gt; [11] 1.407960e-40 1.297221e-40 1.368410e-40 1.202303e-40 8.226283e-41
#&gt; [16] 8.226283e-41 1.162753e-40 2.562803e-40 2.404606e-40 2.681452e-40
#&gt; [21] 1.700626e-40 1.226032e-40 1.202303e-40 1.052015e-40 1.518698e-40
#&gt; [26] 2.159399e-40 2.056571e-40 2.404606e-40 1.249762e-40 1.558248e-40
#&gt; [31] 1.186483e-40 1.692716e-40</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>cyl</span><span class='op'>)</span>             <span class='co'># Grouped product</span>
</div><div class='output co'>#&gt;            4            6            8 
#&gt; 4.204745e+15 1.150054e+09 2.614398e+16 </div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>cyl</span>, <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>hp</span><span class='op'>)</span>  <span class='co'># Weighted grouped product</span>
</div><div class='output co'>#&gt;            4            6            8 
#&gt; 3.686893e+36 4.255338e+23 5.653910e+48 </div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>,<span class='fl'>8</span><span class='op'>:</span><span class='fl'>9</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>       <span class='co'># More groups..</span>
</div><div class='output co'>#&gt;        4.0.1        4.1.0        4.1.1        6.0.1        6.1.0        8.0.0 
#&gt; 2.600000e+01 1.196088e+04 1.352082e+10 8.687700e+03 1.323773e+05 1.103122e+14 
#&gt;        8.0.1 
#&gt; 2.370000e+02 </div><div class='input'><span class='va'>g</span> <span class='op'>&lt;-</span> <span class='fu'><a href='GRP, fgroup_by.html'>GRP</a></span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='op'>~</span> <span class='va'>cyl</span> <span class='op'>+</span> <span class='va'>vs</span> <span class='op'>+</span> <span class='va'>am</span><span class='op'>)</span>  <span class='co'># Precomputing groups gives more speed !</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>g</span><span class='op'>)</span>
</div><div class='output co'>#&gt;        4.0.1        4.1.0        4.1.1        6.0.1        6.1.0        8.0.0 
#&gt; 2.600000e+01 1.196088e+04 1.352082e+10 8.687700e+03 1.323773e+05 1.103122e+14 
#&gt;        8.0.1 
#&gt; 2.370000e+02 </div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mpg</span>, <span class='va'>g</span>, TRA <span class='op'>=</span> <span class='st'>"/"</span><span class='op'>)</span>           <span class='co'># Groupwise divide by product</span>
</div><div class='output co'>#&gt;  [1] 2.417211e-03 2.417211e-03 1.686288e-09 1.616591e-04 1.695190e-13
#&gt;  [6] 1.367304e-04 1.296321e-13 2.039984e-03 1.906214e-03 1.450400e-04
#&gt; [11] 1.344641e-04 1.486690e-13 1.568277e-13 1.377908e-13 9.427792e-14
#&gt; [16] 9.427792e-14 1.332582e-13 2.396304e-09 2.248384e-09 2.507244e-09
#&gt; [21] 1.797527e-03 1.405104e-13 1.377908e-13 1.205670e-13 1.740515e-13
#&gt; [26] 2.019108e-09 1.000000e+00 2.248384e-09 6.666667e-02 2.267574e-03
#&gt; [31] 6.329114e-02 1.582744e-09</div><div class='input'>
<span class='co'>## data.frame method</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          mpg          cyl         disp           hp         drat           wt 
#&gt; 1.264241e+41 5.163908e+24 2.789968e+73 7.016390e+67 4.366447e+17 3.884021e+15 
#&gt;         qsec           vs           am         gear         carb 
#&gt; 9.651882e+39 0.000000e+00 0.000000e+00 7.522960e+17 1.391569e+12 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mtcars</span>, TRA <span class='op'>=</span> <span class='st'>"/"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                            mpg          cyl         disp           hp
#&gt; Mazda RX4         1.661076e-40 1.161911e-24 5.734833e-72 1.567758e-66
#&gt; Mazda RX4 Wag     1.661076e-40 1.161911e-24 5.734833e-72 1.567758e-66
#&gt; Datsun 710        1.803454e-40 7.746072e-25 3.871012e-72 1.325468e-66
#&gt; Hornet 4 Drive    1.692716e-40 1.161911e-24 9.247418e-72 1.567758e-66
#&gt; Hornet Sportabout 1.479149e-40 1.549214e-24 1.290337e-71 2.494160e-66
#&gt; Valiant           1.431690e-40 1.161911e-24 8.064609e-72 1.496496e-66
#&gt;                           drat           wt         qsec  vs  am         gear
#&gt; Mazda RX4         8.931747e-18 6.745586e-16 1.705367e-39 NaN Inf 5.317056e-18
#&gt; Mazda RX4 Wag     8.931747e-18 7.402122e-16 1.763387e-39 NaN Inf 5.317056e-18
#&gt; Datsun 710        8.817237e-18 5.973191e-16 1.928121e-39 Inf Inf 5.317056e-18
#&gt; Hornet 4 Drive    7.053790e-18 8.277504e-16 2.014115e-39 Inf NaN 3.987792e-18
#&gt; Hornet Sportabout 7.214103e-18 8.856800e-16 1.763387e-39 NaN NaN 3.987792e-18
#&gt; Valiant           6.320928e-18 8.908293e-16 2.094928e-39 Inf NaN 3.987792e-18
#&gt;                           carb
#&gt; Mazda RX4         2.874452e-12
#&gt; Mazda RX4 Wag     2.874452e-12
#&gt; Datsun 710        7.186131e-13
#&gt; Hornet 4 Drive    7.186131e-13
#&gt; Hornet Sportabout 1.437226e-12
#&gt; Valiant           7.186131e-13</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>g</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                mpg         cyl         disp           hp         drat
#&gt; 4.0.1 2.600000e+01           4 1.203000e+02 9.100000e+01      4.43000
#&gt; 4.1.0 1.196088e+04          64 2.480709e+06 5.713300e+05     53.51976
#&gt; 4.1.1 1.352082e+10       16384 4.158694e+13 1.686524e+13  20659.68036
#&gt; 6.0.1 8.687700e+03         216 3.712000e+06 2.117500e+06     55.06020
#&gt; 6.1.0 1.323773e+05        1296 1.630611e+09 1.747400e+08    130.62669
#&gt; 8.0.0 1.103122e+14 68719476736 3.515354e+30 2.445279e+27 829662.18170
#&gt; 8.0.1 2.370000e+02          64 1.056510e+05 8.844000e+04     14.93880
#&gt;                 wt         qsec vs am   gear   carb
#&gt; 4.0.1 2.140000e+00 1.670000e+01  0  1      5      2
#&gt; 4.1.0 2.476955e+01 9.164580e+03  1  0     48      4
#&gt; 4.1.1 1.231073e+02 7.933555e+08  1  1  20480      8
#&gt; 6.0.1 2.086503e+01 4.342313e+03  0  1     80     96
#&gt; 6.1.0 1.316358e+02 1.359535e+05  1  0    144     16
#&gt; 8.0.0 1.914897e+07 6.360378e+14  0  0 531441 442368
#&gt; 8.0.1 1.131690e+01 2.117000e+02  0  1     25     32</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>mtcars</span>, <span class='va'>g</span>, use.g.names <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span> <span class='co'># No row-names generated</span>
</div><div class='output co'>#&gt;            mpg         cyl         disp           hp         drat           wt
#&gt; 1 2.600000e+01           4 1.203000e+02 9.100000e+01      4.43000 2.140000e+00
#&gt; 2 1.196088e+04          64 2.480709e+06 5.713300e+05     53.51976 2.476955e+01
#&gt; 3 1.352082e+10       16384 4.158694e+13 1.686524e+13  20659.68036 1.231073e+02
#&gt; 4 8.687700e+03         216 3.712000e+06 2.117500e+06     55.06020 2.086503e+01
#&gt; 5 1.323773e+05        1296 1.630611e+09 1.747400e+08    130.62669 1.316358e+02
#&gt; 6 1.103122e+14 68719476736 3.515354e+30 2.445279e+27 829662.18170 1.914897e+07
#&gt; 7 2.370000e+02          64 1.056510e+05 8.844000e+04     14.93880 1.131690e+01
#&gt;           qsec vs am   gear   carb
#&gt; 1 1.670000e+01  0  1      5      2
#&gt; 2 9.164580e+03  1  0     48      4
#&gt; 3 7.933555e+08  1  1  20480      8
#&gt; 4 4.342313e+03  0  1     80     96
#&gt; 5 1.359535e+05  1  0    144     16
#&gt; 6 6.360378e+14  0  0 531441 442368
#&gt; 7 2.117000e+02  0  1     25     32</div><div class='input'>
<span class='co'>## matrix method</span>
<span class='va'>m</span> <span class='op'>&lt;-</span> <span class='fu'><a href='quick-conversion.html'>qM</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>)</span>
<span class='fu'>fprod</span><span class='op'>(</span><span class='va'>m</span><span class='op'>)</span>
</div><div class='output co'>#&gt;          mpg          cyl         disp           hp         drat           wt 
#&gt; 1.264241e+41 5.163908e+24 2.789968e+73 7.016390e+67 4.366447e+17 3.884021e+15 
#&gt;         qsec           vs           am         gear         carb 
#&gt; 9.651882e+39 0.000000e+00 0.000000e+00 7.522960e+17 1.391569e+12 </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>m</span>, TRA <span class='op'>=</span> <span class='st'>"/"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                            mpg          cyl         disp           hp
#&gt; Mazda RX4         1.661076e-40 1.161911e-24 5.734833e-72 1.567758e-66
#&gt; Mazda RX4 Wag     1.661076e-40 1.161911e-24 5.734833e-72 1.567758e-66
#&gt; Datsun 710        1.803454e-40 7.746072e-25 3.871012e-72 1.325468e-66
#&gt; Hornet 4 Drive    1.692716e-40 1.161911e-24 9.247418e-72 1.567758e-66
#&gt; Hornet Sportabout 1.479149e-40 1.549214e-24 1.290337e-71 2.494160e-66
#&gt; Valiant           1.431690e-40 1.161911e-24 8.064609e-72 1.496496e-66
#&gt;                           drat           wt         qsec  vs  am         gear
#&gt; Mazda RX4         8.931747e-18 6.745586e-16 1.705367e-39 NaN Inf 5.317056e-18
#&gt; Mazda RX4 Wag     8.931747e-18 7.402122e-16 1.763387e-39 NaN Inf 5.317056e-18
#&gt; Datsun 710        8.817237e-18 5.973191e-16 1.928121e-39 Inf Inf 5.317056e-18
#&gt; Hornet 4 Drive    7.053790e-18 8.277504e-16 2.014115e-39 Inf NaN 3.987792e-18
#&gt; Hornet Sportabout 7.214103e-18 8.856800e-16 1.763387e-39 NaN NaN 3.987792e-18
#&gt; Valiant           6.320928e-18 8.908293e-16 2.094928e-39 Inf NaN 3.987792e-18
#&gt;                           carb
#&gt; Mazda RX4         2.874452e-12
#&gt; Mazda RX4 Wag     2.874452e-12
#&gt; Datsun 710        7.186131e-13
#&gt; Hornet 4 Drive    7.186131e-13
#&gt; Hornet Sportabout 1.437226e-12
#&gt; Valiant           7.186131e-13</div><div class='input'><span class='fu'>fprod</span><span class='op'>(</span><span class='va'>m</span>, <span class='va'>g</span><span class='op'>)</span> <span class='co'># etc..</span>
</div><div class='output co'>#&gt;                mpg         cyl         disp           hp         drat
#&gt; 4.0.1 2.600000e+01           4 1.203000e+02 9.100000e+01      4.43000
#&gt; 4.1.0 1.196088e+04          64 2.480709e+06 5.713300e+05     53.51976
#&gt; 4.1.1 1.352082e+10       16384 4.158694e+13 1.686524e+13  20659.68036
#&gt; 6.0.1 8.687700e+03         216 3.712000e+06 2.117500e+06     55.06020
#&gt; 6.1.0 1.323773e+05        1296 1.630611e+09 1.747400e+08    130.62669
#&gt; 8.0.0 1.103122e+14 68719476736 3.515354e+30 2.445279e+27 829662.18170
#&gt; 8.0.1 2.370000e+02          64 1.056510e+05 8.844000e+04     14.93880
#&gt;                 wt         qsec vs am   gear   carb
#&gt; 4.0.1 2.140000e+00 1.670000e+01  0  1      5      2
#&gt; 4.1.0 2.476955e+01 9.164580e+03  1  0     48      4
#&gt; 4.1.1 1.231073e+02 7.933555e+08  1  1  20480      8
#&gt; 6.0.1 2.086503e+01 4.342313e+03  0  1     80     96
#&gt; 6.1.0 1.316358e+02 1.359535e+05  1  0    144     16
#&gt; 8.0.0 1.914897e+07 6.360378e+14  0  0 531441 442368
#&gt; 8.0.1 1.131690e+01 2.117000e+02  0  1     25     32</div><div class='input'> 
<span class='co'>## method for grouped data frames - created with dplyr::group_by or fgroup_by</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
<span class='va'>mtcars</span> |&gt; <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>cyl</span>,<span class='va'>vs</span>,<span class='va'>am</span><span class='op'>)</span> |&gt; <span class='fu'>fprod</span><span class='op'>(</span><span class='va'>hp</span><span class='op'>)</span>   <span class='co'># Weighted grouped product</span>
</div><div class='output co'>#&gt; <span style='color: #949494;'># A tibble: 7 x 11</span><span>
#&gt;     cyl    vs    am prod.hp     mpg    disp    drat      wt    qsec    gear
#&gt;   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>   </span><span style='color: #949494;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #BCBCBC;'>1</span><span>     4     0     1 9.1 </span><span style='color: #949494;'>e</span><span> 1 2.37</span><span style='color: #949494;'>e</span><span> 3 1.09</span><span style='color: #949494;'>e</span><span> 4 4.03</span><span style='color: #949494;'>e</span><span> 2 1.95</span><span style='color: #949494;'>e</span><span> 2 1.52</span><span style='color: #949494;'>e</span><span> 3 4.55</span><span style='color: #949494;'>e</span><span> 2
#&gt; </span><span style='color: #BCBCBC;'>2</span><span>     4     1     0 5.71</span><span style='color: #949494;'>e</span><span> 5 6.83</span><span style='color: #949494;'>e</span><span> 9 1.42</span><span style='color: #949494;'>e</span><span>12 3.06</span><span style='color: #949494;'>e</span><span> 7 1.42</span><span style='color: #949494;'>e</span><span> 7 5.24</span><span style='color: #949494;'>e</span><span> 9 2.74</span><span style='color: #949494;'>e</span><span> 7
#&gt; </span><span style='color: #BCBCBC;'>3</span><span>     4     1     1 1.69</span><span style='color: #949494;'>e</span><span>13 2.28</span><span style='color: #949494;'>e</span><span>23 7.01</span><span style='color: #949494;'>e</span><span>26 3.48</span><span style='color: #949494;'>e</span><span>17 2.08</span><span style='color: #949494;'>e</span><span>15 1.34</span><span style='color: #949494;'>e</span><span>22 3.45</span><span style='color: #949494;'>e</span><span>17
#&gt; </span><span style='color: #BCBCBC;'>4</span><span>     6     0     1 2.12</span><span style='color: #949494;'>e</span><span> 6 1.84</span><span style='color: #949494;'>e</span><span>10 7.86</span><span style='color: #949494;'>e</span><span>12 1.17</span><span style='color: #949494;'>e</span><span> 8 4.42</span><span style='color: #949494;'>e</span><span> 7 9.19</span><span style='color: #949494;'>e</span><span> 9 1.69</span><span style='color: #949494;'>e</span><span> 8
#&gt; </span><span style='color: #BCBCBC;'>5</span><span>     6     1     0 1.75</span><span style='color: #949494;'>e</span><span> 8 2.31</span><span style='color: #949494;'>e</span><span>13 2.85</span><span style='color: #949494;'>e</span><span>17 2.28</span><span style='color: #949494;'>e</span><span>10 2.30</span><span style='color: #949494;'>e</span><span>10 2.38</span><span style='color: #949494;'>e</span><span>13 2.52</span><span style='color: #949494;'>e</span><span>10
#&gt; </span><span style='color: #BCBCBC;'>6</span><span>     8     0     0 2.45</span><span style='color: #949494;'>e</span><span>27 2.70</span><span style='color: #949494;'>e</span><span>41 8.60</span><span style='color: #949494;'>e</span><span>57 2.03</span><span style='color: #949494;'>e</span><span>33 4.68</span><span style='color: #949494;'>e</span><span>34 1.56</span><span style='color: #949494;'>e</span><span>42 1.30</span><span style='color: #949494;'>e</span><span>33
#&gt; </span><span style='color: #BCBCBC;'>7</span><span>     8     0     1 8.84</span><span style='color: #949494;'>e</span><span> 4 2.10</span><span style='color: #949494;'>e</span><span> 7 9.34</span><span style='color: #949494;'>e</span><span> 9 1.32</span><span style='color: #949494;'>e</span><span> 6 1.00</span><span style='color: #949494;'>e</span><span> 6 1.87</span><span style='color: #949494;'>e</span><span> 7 2.21</span><span style='color: #949494;'>e</span><span> 6
#&gt; </span><span style='color: #949494;'># ... with 1 more variable: carb &lt;dbl&gt;</span><span></div><div class='input'><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='GRP, fgroup_by.html'>fgroup_by</a></span><span class='op'>(</span><span class='va'>cyl</span>,<span class='va'>vs</span>,<span class='va'>am</span><span class='op'>)</span> |&gt; <span class='fu'>fprod</span><span class='op'>(</span><span class='va'>hp</span><span class='op'>)</span>  <span class='co'># Equivalent and faster</span>
</div><div class='output co'>#&gt;   cyl vs am      prod.hp          mpg         disp         drat           wt
#&gt; 1   4  0  1 9.100000e+01 2.366000e+03 1.094730e+04 4.031300e+02 1.947400e+02
#&gt; 2   4  1  0 5.713300e+05 6.833610e+09 1.417303e+12 3.057744e+07 1.415159e+07
#&gt; 3   4  1  1 1.686524e+13 2.280319e+23 7.013736e+26 3.484304e+17 2.076235e+15
#&gt; 4   6  0  1 2.117500e+06 1.839620e+10 7.860160e+12 1.165900e+08 4.418169e+07
#&gt; 5   6  1  0 1.747400e+08 2.313161e+13 2.849328e+17 2.282570e+10 2.300203e+10
#&gt; 6   8  0  0 2.445279e+27 2.697440e+41 8.596021e+57 2.028756e+33 4.682457e+34
#&gt; 7   8  0  1 8.844000e+04 2.096028e+07 9.343774e+09 1.321187e+06 1.000867e+06
#&gt;           qsec         gear         carb
#&gt; 1 1.519700e+03 4.550000e+02 1.820000e+02
#&gt; 2 5.235999e+09 2.742384e+07 2.285320e+06
#&gt; 3 1.338013e+22 3.454001e+17 1.349219e+14
#&gt; 4 9.194847e+09 1.694000e+08 2.032800e+08
#&gt; 5 2.375650e+13 2.516255e+10 2.795839e+09
#&gt; 6 1.555290e+42 1.299522e+33 1.081713e+33
#&gt; 7 1.872275e+07 2.211000e+06 2.830080e+06</div><div class='input'><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='GRP, fgroup_by.html'>fgroup_by</a></span><span class='op'>(</span><span class='va'>cyl</span>,<span class='va'>vs</span>,<span class='va'>am</span><span class='op'>)</span> |&gt; <span class='fu'>fprod</span><span class='op'>(</span>TRA <span class='op'>=</span> <span class='st'>"/"</span><span class='op'>)</span>
</div><div class='output co'>#&gt;                     cyl vs am          mpg         disp           hp
#&gt; Mazda RX4             6  0  1 2.417211e-03 4.310345e-05 5.194805e-05
#&gt; Mazda RX4 Wag         6  0  1 2.417211e-03 4.310345e-05 5.194805e-05
#&gt; Datsun 710            4  1  1 1.686288e-09 2.596969e-12 5.514301e-12
#&gt; Hornet 4 Drive        6  1  0 1.616591e-04 1.582229e-07 6.295069e-07
#&gt; Hornet Sportabout     8  0  0 1.695190e-13 1.024079e-28 7.156647e-26
#&gt; Valiant               6  1  0 1.367304e-04 1.379851e-07 6.008929e-07
#&gt; Duster 360            8  0  0 1.296321e-13 1.024079e-28 1.001931e-25
#&gt; Merc 240D             4  1  0 2.039984e-03 5.913633e-05 1.085187e-04
#&gt; Merc 230              4  1  0 1.906214e-03 5.675797e-05 1.662787e-04
#&gt; Merc 280              6  1  0 1.450400e-04 1.027836e-07 7.039031e-07
#&gt; Merc 280C             6  1  0 1.344641e-04 1.027836e-07 7.039031e-07
#&gt; Merc 450SE            8  0  0 1.486690e-13 7.845583e-29 7.361123e-26
#&gt; Merc 450SL            8  0  0 1.568277e-13 7.845583e-29 7.361123e-26
#&gt; Merc 450SLC           8  0  0 1.377908e-13 7.845583e-29 7.361123e-26
#&gt; Cadillac Fleetwood    8  0  0 9.427792e-14 1.342681e-28 8.383501e-26
#&gt; Lincoln Continental   8  0  0 9.427792e-14 1.308545e-28 8.792452e-26
#&gt; Chrysler Imperial     8  0  0 1.332582e-13 1.251652e-28 9.405879e-26
#&gt; Fiat 128              4  1  1 2.396304e-09 1.892421e-12 3.913375e-12
#&gt; Honda Civic           4  1  1 2.248384e-09 1.820283e-12 3.083265e-12
#&gt; Toyota Corolla        4  1  1 2.507244e-09 1.709671e-12 3.854082e-12
#&gt; Toyota Corona         4  1  0 1.797527e-03 4.841358e-05 1.697793e-04
#&gt; Dodge Challenger      8  0  0 1.405104e-13 9.046031e-29 6.134269e-26
#&gt; AMC Javelin           8  0  0 1.377908e-13 8.647778e-29 6.134269e-26
#&gt; Camaro Z28            8  0  0 1.205670e-13 9.956324e-29 1.001931e-25
#&gt; Pontiac Firebird      8  0  0 1.740515e-13 1.137866e-28 7.156647e-26
#&gt; Fiat X1-9             4  1  1 2.019108e-09 1.899635e-12 3.913375e-12
#&gt; Porsche 914-2         4  0  1 1.000000e+00 1.000000e+00 1.000000e+00
#&gt; Lotus Europa          4  1  1 2.248384e-09 2.286776e-12 6.700172e-12
#&gt; Ford Pantera L        8  0  1 6.666667e-02 3.322259e-03 2.985075e-03
#&gt; Ferrari Dino          6  0  1 2.267574e-03 3.906250e-05 8.264463e-05
#&gt; Maserati Bora         8  0  1 6.329114e-02 2.849003e-03 3.787879e-03
#&gt; Volvo 142E            4  1  1 1.582744e-09 2.909567e-12 6.462998e-12
#&gt;                             drat           wt         qsec         gear
#&gt; Mazda RX4           7.083156e-02 1.255690e-01 3.790607e-03 5.000000e-02
#&gt; Mazda RX4 Wag       7.083156e-02 1.377904e-01 3.919570e-03 5.000000e-02
#&gt; Datsun 710          1.863533e-04 1.884534e-02 2.345733e-08 1.953125e-04
#&gt; Hornet 4 Drive      2.357864e-02 2.442345e-02 1.429901e-04 2.083333e-02
#&gt; Hornet Sportabout   3.796726e-06 1.796441e-07 2.675942e-14 5.645029e-06
#&gt; Valiant             2.112891e-02 2.628465e-02 1.487274e-04 2.083333e-02
#&gt; Duster 360          3.869045e-06 1.864330e-07 2.490418e-14 5.645029e-06
#&gt; Merc 240D           6.894650e-02 1.287871e-01 2.182315e-03 8.333333e-02
#&gt; Merc 230            7.324398e-02 1.271723e-01 2.498751e-03 8.333333e-02
#&gt; Merc 280            3.000918e-02 2.613271e-02 1.346049e-04 2.777778e-02
#&gt; Merc 280C           3.000918e-02 2.613271e-02 1.390181e-04 2.777778e-02
#&gt; Merc 450SE          3.700301e-06 2.125441e-07 2.735687e-14 5.645029e-06
#&gt; Merc 450SL          3.700301e-06 1.947886e-07 2.767131e-14 5.645029e-06
#&gt; Merc 450SLC         3.700301e-06 1.973997e-07 2.830021e-14 5.645029e-06
#&gt; Cadillac Fleetwood  3.531558e-06 2.741662e-07 2.826876e-14 5.645029e-06
#&gt; Lincoln Continental 3.615930e-06 2.832529e-07 2.801720e-14 5.645029e-06
#&gt; Chrysler Imperial   3.893151e-06 2.791273e-07 2.738831e-14 5.645029e-06
#&gt; Fiat 128            1.974861e-04 1.787058e-02 2.454133e-08 1.953125e-04
#&gt; Honda Civic         2.386291e-04 1.311863e-02 2.334389e-08 1.953125e-04
#&gt; Toyota Corolla      2.042626e-04 1.490569e-02 2.508333e-08 1.953125e-04
#&gt; Toyota Corona       6.913334e-02 9.951734e-02 2.183406e-03 6.250000e-02
#&gt; Dodge Challenger    3.326655e-06 1.838219e-07 2.652358e-14 5.645029e-06
#&gt; AMC Javelin         3.796726e-06 1.793830e-07 2.719964e-14 5.645029e-06
#&gt; Camaro Z28          4.495806e-06 2.005330e-07 2.422812e-14 5.645029e-06
#&gt; Pontiac Firebird    3.712354e-06 2.007941e-07 2.680658e-14 5.645029e-06
#&gt; Fiat X1-9           1.974861e-04 1.571799e-02 2.382286e-08 1.953125e-04
#&gt; Porsche 914-2       1.000000e+00 1.000000e+00 1.000000e+00 1.000000e+00
#&gt; Lotus Europa        1.824810e-04 1.229009e-02 2.130193e-08 2.441406e-04
#&gt; Ford Pantera L      2.824859e-01 2.801120e-01 6.849315e-02 2.000000e-01
#&gt; Ferrari Dino        6.574622e-02 1.327580e-01 3.569527e-03 6.250000e-02
#&gt; Maserati Bora       2.369668e-01 3.154574e-01 6.896552e-02 2.000000e-01
#&gt; Volvo 142E          1.989382e-04 2.258192e-02 2.344472e-08 1.953125e-04
#&gt;                             carb
#&gt; Mazda RX4           4.166667e-02
#&gt; Mazda RX4 Wag       4.166667e-02
#&gt; Datsun 710          1.250000e-01
#&gt; Hornet 4 Drive      6.250000e-02
#&gt; Hornet Sportabout   4.521123e-06
#&gt; Valiant             6.250000e-02
#&gt; Duster 360          9.042245e-06
#&gt; Merc 240D           5.000000e-01
#&gt; Merc 230            5.000000e-01
#&gt; Merc 280            2.500000e-01
#&gt; Merc 280C           2.500000e-01
#&gt; Merc 450SE          6.781684e-06
#&gt; Merc 450SL          6.781684e-06
#&gt; Merc 450SLC         6.781684e-06
#&gt; Cadillac Fleetwood  9.042245e-06
#&gt; Lincoln Continental 9.042245e-06
#&gt; Chrysler Imperial   9.042245e-06
#&gt; Fiat 128            1.250000e-01
#&gt; Honda Civic         2.500000e-01
#&gt; Toyota Corolla      1.250000e-01
#&gt; Toyota Corona       2.500000e-01
#&gt; Dodge Challenger    4.521123e-06
#&gt; AMC Javelin         4.521123e-06
#&gt; Camaro Z28          9.042245e-06
#&gt; Pontiac Firebird    4.521123e-06
#&gt; Fiat X1-9           1.250000e-01
#&gt; Porsche 914-2       1.000000e+00
#&gt; Lotus Europa        2.500000e-01
#&gt; Ford Pantera L      1.250000e-01
#&gt; Ferrari Dino        6.250000e-02
#&gt; Maserati Bora       2.500000e-01
#&gt; Volvo 142E          2.500000e-01
#&gt; 
#&gt; Grouped by:  cyl, vs, am  [7 | 5 (3.8)] </div><div class='input'><span class='va'>mtcars</span> |&gt; <span class='fu'><a href='GRP, fgroup_by.html'>fgroup_by</a></span><span class='op'>(</span><span class='va'>cyl</span>,<span class='va'>vs</span>,<span class='va'>am</span><span class='op'>)</span> |&gt; <span class='fu'><a href='fselect, get_vars, add_vars.html'>fselect</a></span><span class='op'>(</span><span class='va'>mpg</span><span class='op'>)</span> |&gt; <span class='fu'>fprod</span><span class='op'>(</span><span class='op'>)</span>
</div><div class='output co'>#&gt;   cyl vs am          mpg
#&gt; 1   4  0  1 2.600000e+01
#&gt; 2   4  1  0 1.196088e+04
#&gt; 3   4  1  1 1.352082e+10
#&gt; 4   6  0  1 8.687700e+03
#&gt; 5   6  1  0 1.323773e+05
#&gt; 6   8  0  0 1.103122e+14
#&gt; 7   8  0  1 2.370000e+02</div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


