<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head><link rel="shortcut icon" href="https://sebkrantz.github.io/collapse/favicon.ico" type="image/x-icon">
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Fast (Weighted) Linear Model Fitting  — flm • collapse</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Fast (Weighted) Linear Model Fitting  — flm" />
<meta property="og:description" content="flm is a fast linear model command that takes matrices as input and (by default) only returns a coefficient matrix. 6 different efficient fitting methods are implemented: 4 using base R linear algebra, and 2 utilizing the RcppArmadillo and RcppEigen packages. The function itself only has an overhead of 5-10 microseconds, and is thus well suited as a bootstrap workhorse." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" target="_blank">Blog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://twitter.com/collapse_R" target="_blank">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" target="_blank">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast (Weighted) Linear Model Fitting <!-- % Sparse, --></h1>
    
    <div class="hidden name"><code>flm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>flm</code> is a fast linear model command that takes matrices as input and (by default) only returns a coefficient matrix. 6 different efficient fitting methods are implemented: 4 using base R linear algebra, and 2 utilizing the <em>RcppArmadillo</em> and <em>RcppEigen</em> packages. The function itself only has an overhead of 5-10 microseconds, and is thus well suited as a bootstrap workhorse.</p>
    </div>

    <pre class="usage">flm(y, X, w = NULL, add.icpt = FALSE, return.raw = FALSE, &lt;!-- % sparse = FALSE --&gt;
    method = c("lm", "solve", "qr", "arma", "chol", "eigen"),
    eigen.method = 3L, ...)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>y</th>
      <td><p>a response vector or matrix. Multiple dependent variables are only supported by methods "lm", "solve", "qr" and "chol".</p></td>
    </tr>
    <tr>
      <th>X</th>
      <td><p>a matrix of regressors.</p></td>
    </tr>
    <tr>
      <th>w</th>
      <td><p>a weight vector.</p></td>
    </tr>
    <tr>
      <th>add.icpt</th>
      <td><p>logical. <code>TRUE</code> adds an intercept column named '(Intercept)' to <code>X</code>.</p></td>
    </tr>
    <tr>
      <th>return.raw</th>
      <td><p>logical. <code>TRUE</code> returns the original output from the different methods. For 'lm', 'arma' and 'eigen', this includes additional statistics such as residuals, fitted values or standard errors. The other methods just return coefficients but in different formats.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>an integer or character string specifying the method of computation:</p><table class='table'>
<tr><td><em> Int. </em></td><td></td><td><em> String </em></td><td></td><td><em> Description </em></td></tr>
<tr><td>1</td><td></td><td>"lm"</td><td></td><td>uses <code><a href='https://rdrr.io/r/stats/lmfit.html'>.lm.fit</a></code>.</td></tr>
<tr><td>2</td><td></td><td>"solve"</td><td></td><td><code><a href='https://rdrr.io/r/base/solve.html'>solve(crossprod(X), crossprod(X, y))</a></code>.</td></tr>
<tr><td>3</td><td></td><td>"qr"</td><td></td><td><code><a href='https://rdrr.io/r/base/qr.html'>qr.coef(qr(X), y)</a></code>.</td></tr>
<tr><td>4</td><td></td><td>"arma"</td><td></td><td>uses <code><a href='https://rdrr.io/pkg/RcppArmadillo/man/fastLm.html'>RcppArmadillo::fastLmPure</a></code>.</td></tr>
<tr><td>5</td><td></td><td>"chol"</td><td></td><td><code>chol2inv(chol(crossprod(X))) %*% crossprod(X, y)</code> (quite fast but requires <code><a href='https://rdrr.io/r/base/crossprod.html'>crossprod(X)</a></code> to be positive definite).</td></tr>
<tr><td>6</td><td></td><td>"eigen"</td><td></td><td>uses <code><a href='https://rdrr.io/pkg/RcppEigen/man/fastLm.html'>RcppEigen::fastLmPure</a></code> (very fast but potentially unstable, depending on the method).</td></tr>
</table>

</td>
    </tr>
    <tr>
      <th>eigen.method</th>
      <td><p>integer. Select the method of computation used by <code><a href='https://rdrr.io/pkg/RcppEigen/man/fastLm.html'>RcppEigen::fastLmPure</a></code>:</p><table class='table'>
<tr><td><em> Int. </em></td><td></td><td><em> Description </em></td></tr>
<tr><td>0</td><td></td><td>column-pivoted QR decomposition.</td></tr>
<tr><td>1</td><td></td><td>unpivoted QR decomposition.</td></tr>
<tr><td>2</td><td></td><td>LLT Cholesky.</td></tr>
<tr><td>3</td><td></td><td>LDLT Cholesky.</td></tr>
<tr><td>4</td><td></td><td>Jacobi singular value decomposition (SVD).</td></tr>
<tr><td>5</td><td></td><td>method based on the eigenvalue-eigenvector decomposition of X'X.</td></tr>
</table>
<p>See <code><a href='https://cran.rstudio.com/web/packages/RcppEigen/vignettes/RcppEigen-Introduction.pdf'>vignette("RcppEigen-Introduction", package = "RcppEigen")</a></code> for details on these methods and benchmark results. Run <code><a href='https://rdrr.io/r/base/source.html'>source(system.file("examples", "lmBenchmark.R", package = "RcppEigen"))</a></code> to re-run the benchmark on your machine.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>further arguments passed to other methods. Sensible choices are <code>tol = value</code> - a numerical tolerance for the solution - applicable with methods "lm", "solve" and "qr" (default is <code>1e-7</code>), or <code>LAPACK = TRUE</code> with method "qr" to use LAPACK routines to for the qr decomposition (typically faster than LINPACK (the default)).</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>If <code>return.raw = FALSE</code>, a matrix of coefficients with the rows corresponding to the columns of <code>X</code>, otherwise the raw results from the various methods are returned.</p>
    <h2 class="hasAnchor" id="note"><a class="anchor" href="#note"></a>Note</h2>

    <p>Method "qr" supports sparse matrices, so for an <code>X</code> matrix with many dummy variables consider method "qr" passing <code>as(X, "dgCMatrix")</code> instead of just <code>X</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='fHDbetween, fHDwithin.html'>fHDwithin/HDW</a></code>, <code><a href='fFtest.html'>fFtest</a></code>, <a href='data-transformations.html'>Data Transformations</a>, <a href='index.html'>Collapse Overview</a></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>coef</span> <span class='op'>&lt;-</span> <span class='fu'>flm</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>$</span><span class='va'>mpg</span>, <span class='fu'><a href='quick-conversion.html'>qM</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"hp"</span>,<span class='st'>"carb"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>,
            <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>wt</span>, add.icpt <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='va'>coef</span>
</div><div class='output co'>#&gt;                    [,1]
#&gt; (Intercept) 28.48401839
#&gt; hp          -0.06834996
#&gt; carb         0.33207257</div><div class='input'>
<span class='va'>lmcoef</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span><span class='va'>mpg</span> <span class='op'>~</span> <span class='va'>hp</span> <span class='op'>+</span> <span class='va'>carb</span>, weights <span class='op'>=</span> <span class='va'>wt</span>, <span class='va'>mtcars</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>lmcoef</span>
</div><div class='output co'>#&gt; (Intercept)          hp        carb 
#&gt; 28.48401839 -0.06834996  0.33207257 </div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/drop.html'>drop</a></span><span class='op'>(</span><span class='va'>coef</span><span class='op'>)</span>, <span class='va'>lmcoef</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
 
<span class='fu'><a href='small-helpers.html'>all_obj_equal</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/lapply.html'>lapply</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='kw'>function</span><span class='op'>(</span><span class='va'>i</span><span class='op'>)</span>
  <span class='fu'>flm</span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>$</span><span class='va'>mpg</span>, <span class='fu'><a href='quick-conversion.html'>qM</a></span><span class='op'>(</span><span class='va'>mtcars</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"hp"</span>,<span class='st'>"carb"</span><span class='op'>)</span><span class='op'>]</span><span class='op'>)</span>,
      <span class='va'>mtcars</span><span class='op'>$</span><span class='va'>wt</span>, add.icpt <span class='op'>=</span> <span class='cn'>TRUE</span>, method <span class='op'>=</span> <span class='va'>i</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


