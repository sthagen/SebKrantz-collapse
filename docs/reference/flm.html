<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><link rel="shortcut icon" href="https://sebkrantz.github.io/collapse/favicon.ico" type="image/x-icon">
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Fast (Weighted) Linear Model Fitting  — flm • collapse</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Fast (Weighted) Linear Model Fitting  — flm"><meta property="og:description" content="flm is a fast linear model command that takes matrices as input and (by default) only returns a coefficient matrix. 6 different efficient fitting methods are implemented: 4 using base R linear algebra, and 2 utilizing the RcppArmadillo and RcppEigen packages. The function itself only has an overhead of 5-10 microseconds, and is thus well suited as a bootstrap workhorse."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">collapse</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.7.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Documentation</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://sebkrantz.github.io/Rblog/" class="external-link">Blog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://twitter.com/collapse_R" class="external-link">
    <span class="fa fa-twitter"></span>

  </a>
</li>
<li>
  <a href="https://github.com/SebKrantz/collapse" class="external-link">
    <span class="fa fa-github"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Fast (Weighted) Linear Model Fitting <!-- % Sparse, --></h1>

    <div class="hidden name"><code>flm.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>flm</code> is a fast linear model command that takes matrices as input and (by default) only returns a coefficient matrix. 6 different efficient fitting methods are implemented: 4 using base R linear algebra, and 2 utilizing the <em>RcppArmadillo</em> and <em>RcppEigen</em> packages. The function itself only has an overhead of 5-10 microseconds, and is thus well suited as a bootstrap workhorse.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre><code>flm(y, X, w = NULL, add.icpt = FALSE, return.raw = FALSE, &lt;!-- % sparse = FALSE --&gt;
    method = c("lm", "solve", "qr", "arma", "chol", "eigen"),
    eigen.method = 3L, ...)</code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>y</dt>
<dd><p>a response vector or matrix. Multiple dependent variables are only supported by methods "lm", "solve", "qr" and "chol".</p></dd>
<dt>X</dt>
<dd><p>a matrix of regressors.</p></dd>
<dt>w</dt>
<dd><p>a weight vector.</p></dd>
<dt>add.icpt</dt>
<dd><p>logical. <code>TRUE</code> adds an intercept column named '(Intercept)' to <code>X</code>.</p></dd>
</dl><p><!-- % \item{sparse}{logical. \code{TRUE} coerces \code{X} to a sparse matrix using \code{as(X, "dgCMatrix")}.} --></p>
<dl><dt>return.raw</dt>
<dd><p>logical. <code>TRUE</code> returns the original output from the different methods. For 'lm', 'arma' and 'eigen', this includes additional statistics such as residuals, fitted values or standard errors. The other methods just return coefficients but in different formats.</p></dd>
<dt>method</dt>
<dd><p>an integer or character string specifying the method of computation:</p><table class="table table"><tr><td><em> Int. </em></td><td></td><td><em> String </em></td><td></td><td><em> Description </em></td></tr><tr><td>1</td><td></td><td>"lm"</td><td></td><td>uses <code><a href="https://rdrr.io/r/stats/lmfit.html" class="external-link">.lm.fit</a></code>.</td></tr><tr><td>2</td><td></td><td>"solve"</td><td></td><td><code>solve(crossprod(X), crossprod(X, y))</code>.</td></tr><tr><td>3</td><td></td><td>"qr"</td><td></td><td><code>qr.coef(qr(X), y)</code>.</td></tr><tr><td>4</td><td></td><td>"arma"</td><td></td><td>uses <code><a href="https://rdrr.io/pkg/RcppArmadillo/man/fastLm.html" class="external-link">RcppArmadillo::fastLmPure</a></code>.</td></tr><tr><td>5</td><td></td><td>"chol"</td><td></td><td><code>chol2inv(chol(crossprod(X))) %*% crossprod(X, y)</code> (quite fast but requires <code>crossprod(X)</code> to be positive definite).</td></tr><tr><td>6</td><td></td><td>"eigen"</td><td></td><td>uses <code><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html" class="external-link">RcppEigen::fastLmPure</a></code> (very fast but potentially unstable, depending on the method).</td></tr></table></dd>
<dt>eigen.method</dt>
<dd><p>integer. Select the method of computation used by <code><a href="https://rdrr.io/pkg/RcppEigen/man/fastLm.html" class="external-link">RcppEigen::fastLmPure</a></code>:</p><table class="table table"><tr><td><em> Int. </em></td><td></td><td><em> Description </em></td></tr><tr><td>0</td><td></td><td>column-pivoted QR decomposition.</td></tr><tr><td>1</td><td></td><td>unpivoted QR decomposition.</td></tr><tr><td>2</td><td></td><td>LLT Cholesky.</td></tr><tr><td>3</td><td></td><td>LDLT Cholesky.</td></tr><tr><td>4</td><td></td><td>Jacobi singular value decomposition (SVD).</td></tr><tr><td>5</td><td></td><td>method based on the eigenvalue-eigenvector decomposition of X'X.</td></tr></table><p>See <code><a href="https://cran.rstudio.com/web/packages/RcppEigen/vignettes/RcppEigen-Introduction.pdf" class="external-link">vignette("RcppEigen-Introduction", package = "RcppEigen")</a></code> for details on these methods and benchmark results. Run <code>source(system.file("examples", "lmBenchmark.R", package = "RcppEigen"))</code> to re-run the benchmark on your machine.</p></dd>
<dt>...</dt>
<dd><p>further arguments passed to other methods. Sensible choices are <code>tol = value</code> - a numerical tolerance for the solution - applicable with methods "lm", "solve" and "qr" (default is <code>1e-7</code>), or <code>LAPACK = TRUE</code> with method "qr" to use LAPACK routines to for the qr decomposition (typically faster than LINPACK (the default)).</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>If <code>return.raw = FALSE</code>, a matrix of coefficients with the rows corresponding to the columns of <code>X</code>, otherwise the raw results from the various methods are returned.</p>
    </div>
    <div id="note">
    <h2>Note</h2>
    <p>Method "qr" supports sparse matrices, so for an <code>X</code> matrix with many dummy variables consider method "qr" passing <code>as(X, "dgCMatrix")</code> instead of just <code>X</code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="fhdbetween_fhdwithin.html">fhdwithin/HDW</a></code>, <code><a href="fFtest.html">fFtest</a></code>, <a href="data-transformations.html">Data Transformations</a>, <a href="index.html">Collapse Overview</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="va">coef</span> <span class="op">&lt;-</span> <span class="fu">flm</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="fu"><a href="quick-conversion.html">qM</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>,<span class="st">"carb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span class="r-in">            <span class="va">mtcars</span><span class="op">$</span><span class="va">wt</span>, add.icpt <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span class="r-in"><span class="va">coef</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                    [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept) 28.48401839</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hp          -0.06834996</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> carb         0.33207257</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">lmcoef</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">+</span> <span class="va">carb</span>, weights <span class="op">=</span> <span class="va">wt</span>, <span class="va">mtcars</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">lmcoef</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)          hp        carb </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 28.48401839 -0.06834996  0.33207257 </span>
<span class="r-in"></span>
<span class="r-in"><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/all.equal.data.table.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/drop.html" class="external-link">drop</a></span><span class="op">(</span><span class="va">coef</span><span class="op">)</span>, <span class="va">lmcoef</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
<span class="r-in"> </span>
<span class="r-in"><span class="fu"><a href="small-helper.html">all_obj_equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span></span>
<span class="r-in">  <span class="fu">flm</span><span class="op">(</span><span class="va">mtcars</span><span class="op">$</span><span class="va">mpg</span>, <span class="fu"><a href="quick-conversion.html">qM</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hp"</span>,<span class="st">"carb"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>,</span>
<span class="r-in">      <span class="va">mtcars</span><span class="op">$</span><span class="va">wt</span>, add.icpt <span class="op">=</span> <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="va">i</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Registered S3 methods overwritten by 'RcppEigen':</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   method               from         </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   predict.fastLm       RcppArmadillo</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   print.fastLm         RcppArmadillo</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   summary.fastLm       RcppArmadillo</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>   print.summary.fastLm RcppArmadillo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Krantz.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>






  </body></html>

